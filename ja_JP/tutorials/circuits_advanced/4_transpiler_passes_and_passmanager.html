

<!DOCTYPE html>
<html class="writer-html5" lang="ja-JP" >
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>トランスパイラー パスとパス マネージャー &mdash; Qiskit 0.20.1 ドキュメント</title>
  

  
  <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/graphviz.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/jupyter-sphinx.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/thebelab.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/css/theme-override.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/style.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/custom.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/gallery.css" type="text/css" />

  
  
    <link rel="shortcut icon" href="../../_static/favicon.ico"/>
  
  
  

  
  <!--[if lt IE 9]>
    <script src="../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
        <script src="../../_static/jquery.js"></script>
        <script src="../../_static/underscore.js"></script>
        <script src="../../_static/doctools.js"></script>
        <script src="../../_static/language_data.js"></script>
        <script src="../../_static/thebelab-helper.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
        <script src="https://unpkg.com/@jupyter-widgets/html-manager@^0.20.0-alpha.0/dist/embed-amd.js"></script>
        <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
        <script async="async" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.7/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
        <script type="text/x-mathjax-config">MathJax.Hub.Config({"tex2jax": {"inlineMath": [["$", "$"], ["\\(", "\\)"]], "processEscapes": true, "ignoreClass": "document", "processClass": "math|output_area"}})</script>
    
    <script type="text/javascript" src="../../_static/js/theme.js"></script>

    
    <link rel="index" title="索引" href="../../genindex.html" />
    <link rel="search" title="検索" href="../../search.html" />
    <link rel="next" title="Pulse Tutorials" href="../pulse/index.html" />
    <link rel="prev" title="量子回路の可視化" href="3_advanced_circuit_visualization.html" />
    <script>
    (function () {
      'use strict'
      window._analytics = {
        segment_key: 'ffdYLviQze3kzomaINXNk6NwpY9LlXcw',
        coremetrics: false,
        optimizely: false,
        googleAddServices: false,
        fullStory: false,
        autoPageEventSpa: false,
        autoFormEvents: false,
        autoPageView: false
      }

      window.digitalData = {
        page: {
          pageInfo: {
            productTitle: 'IBM Q Experience',
            analytics: {
              category: 'Qiskit.org'
            }
          }
        }
      }

      window._analyticsReady = window._analyticsReady || new Promise((resolve) => {
        const script = document.createElement('script')
        script.async = true
        script.src = 'https://cloud.ibm.com/analytics/build/bluemix-analytics.min.js'
        document.head.appendChild(script)
        script.onload = resolve
        script.onerror = (err) => {
          console.warn('Error loading Bluemix Analytics script:', err)
          resolve()
        }
      })

      window._analyticsReady.then(() => {
        if (!window.bluemixAnalytics || !window.digitalData) { return }

        const category = window.digitalData.page.pageInfo.analytics.category
        const productTitle = window.digitalData.page.pageInfo.productTitle
        const routeName = 'api-documentation'

        window.bluemixAnalytics.pageEvent(category, routeName, {
          navigationType: 'pushState',
          productTitle: productTitle,
          title: document.title
        })
      })
    }());
    </script>
     

</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search"  style="background: #212121" >
          

          
            <a href="../../index.html" class="icon icon-home" alt="Documentation Home"> Qiskit
          

          
            
            <img src="../../_static/logo.png" class="logo" alt="Logo"/>
          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul>
<li class="toctree-l1"><a class="reference internal" href="../../install.html">Qiskitのインストール</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../getting_started.html">Qiskit 入門</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../the_elements.html">Qiskit の要素</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../development_strategy.html">開発ストラテジー</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../contributing_to_qiskit.html">Qiskit に貢献する</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../release_notes.html">リリースノート</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../faq.html">よくある質問</a></li>
</ul>
<p class="caption"><span class="caption-text">チュートリアル</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../circuits/index.html">回路</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="index.html">高度な回路</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="1_advanced_circuits.html">高度な回路</a></li>
<li class="toctree-l2"><a class="reference internal" href="2_operators_overview.html">オペレーター</a></li>
<li class="toctree-l2"><a class="reference internal" href="3_advanced_circuit_visualization.html">量子回路の可視化</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">トランスパイラー パスとパス マネージャー</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#はじめに">はじめに</a></li>
<li class="toctree-l3"><a class="reference internal" href="#パスマネージャーオブジェクト">パスマネージャーオブジェクト</a></li>
<li class="toctree-l3"><a class="reference internal" href="#同じパスの異なる実装">同じパスの異なる実装</a></li>
<li class="toctree-l3"><a class="reference internal" href="#プリセット-パスマネージャ">プリセット パスマネージャ</a></li>
<li class="toctree-l3"><a class="reference internal" href="#DAGの紹介">DAGの紹介</a></li>
<li class="toctree-l3"><a class="reference internal" href="#BasicMapper-パスを実装してみる">BasicMapper パスを実装してみる</a></li>
<li class="toctree-l3"><a class="reference internal" href="#トランスパイラーロギング">トランスパイラーロギング</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#Python-ロギング標準ライブラリの設定">Python ロギング標準ライブラリの設定</a></li>
<li class="toctree-l4"><a class="reference internal" href="#トランスパイラーのログレベルを調整する">トランスパイラーのログレベルを調整する</a></li>
<li class="toctree-l4"><a class="reference internal" href="#平行実行を扱うためのログ設定">平行実行を扱うためのログ設定</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../pulse/index.html">パルス</a></li>
<li class="toctree-l1"><a class="reference internal" href="../simulators/index.html">ハイパフォーマンス・シミュレーター</a></li>
<li class="toctree-l1"><a class="reference internal" href="../noise/index.html">量子システムエラー解析</a></li>
<li class="toctree-l1"><a class="reference internal" href="../optimization/index.html">数理最適化</a></li>
<li class="toctree-l1"><a class="reference internal" href="../finance/index.html">金融</a></li>
<li class="toctree-l1"><a class="reference internal" href="../chemistry/index.html">化学</a></li>
</ul>
<p class="caption"><span class="caption-text">ライブラリ</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../apidoc/circuit_library.html">サーキット・ライブラリ</a></li>
</ul>
<p class="caption"><span class="caption-text">API リファレンス</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../apidoc/terra.html">Qiskit Terra</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../apidoc/aer.html">Qiskit Aer</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../apidoc/ignis.html">Qiskit Ignis</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../apidoc/aqua.html">Qiskit Aqua</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../apidoc/ibmq-provider.html">Qiskit IBM Quantum プロバイダー</a></li>
</ul>
<p class="caption"><span class="caption-text">トラブルシューティング</span></p>
<ul>
<li class="toctree-l1"><a class="reference external" href="https://quantum-computing.ibm.com/docs/cloud/errors">Quantum Experience API エラーコード一覧</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">Qiskit</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../index.html" class="icon icon-home"></a> &raquo;</li>
        
          <li><a href="index.html">高度な回路に関するチュートリアル</a> &raquo;</li>
        
      <li>トランスパイラー パスとパス マネージャー</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../../_sources/tutorials/circuits_advanced/4_transpiler_passes_and_passmanager.ipynb" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  
<style>
/* CSS for nbsphinx extension */

/* remove conflicting styling from Sphinx themes */
div.nbinput.container,
div.nbinput.container div.prompt,
div.nbinput.container div.input_area,
div.nbinput.container div[class*=highlight],
div.nbinput.container div[class*=highlight] pre,
div.nboutput.container,
div.nboutput.container div.prompt,
div.nboutput.container div.output_area,
div.nboutput.container div[class*=highlight],
div.nboutput.container div[class*=highlight] pre {
    background: none;
    border: none;
    padding: 0 0;
    margin: 0;
    box-shadow: none;
}

/* avoid gaps between output lines */
div.nboutput.container div[class*=highlight] pre {
    line-height: normal;
}

/* input/output containers */
div.nbinput.container,
div.nboutput.container {
    display: -webkit-flex;
    display: flex;
    align-items: flex-start;
    margin: 0;
    width: 100%;
}
@media (max-width: 540px) {
    div.nbinput.container,
    div.nboutput.container {
        flex-direction: column;
    }
}

/* input container */
div.nbinput.container {
    padding-top: 5px;
}

/* last container */
div.nblast.container {
    padding-bottom: 5px;
}

/* input prompt */
div.nbinput.container div.prompt pre {
    color: #307FC1;
}

/* output prompt */
div.nboutput.container div.prompt pre {
    color: #BF5B3D;
}

/* all prompts */
div.nbinput.container div.prompt,
div.nboutput.container div.prompt {
    width: 4.5ex;
    padding-top: 5px;
    position: relative;
    user-select: none;
}

div.nbinput.container div.prompt > div,
div.nboutput.container div.prompt > div {
    position: absolute;
    right: 0;
    margin-right: 0.3ex;
}

@media (max-width: 540px) {
    div.nbinput.container div.prompt,
    div.nboutput.container div.prompt {
        width: unset;
        text-align: left;
        padding: 0.4em;
    }
    div.nboutput.container div.prompt.empty {
        padding: 0;
    }

    div.nbinput.container div.prompt > div,
    div.nboutput.container div.prompt > div {
        position: unset;
    }
}

/* disable scrollbars on prompts */
div.nbinput.container div.prompt pre,
div.nboutput.container div.prompt pre {
    overflow: hidden;
}

/* input/output area */
div.nbinput.container div.input_area,
div.nboutput.container div.output_area {
    -webkit-flex: 1;
    flex: 1;
    overflow: auto;
}
@media (max-width: 540px) {
    div.nbinput.container div.input_area,
    div.nboutput.container div.output_area {
        width: 100%;
    }
}

/* input area */
div.nbinput.container div.input_area {
    border: 1px solid #e0e0e0;
    border-radius: 2px;
    background: #f5f5f5;
}

/* override MathJax center alignment in output cells */
div.nboutput.container div[class*=MathJax] {
    text-align: left !important;
}

/* override sphinx.ext.imgmath center alignment in output cells */
div.nboutput.container div.math p {
    text-align: left;
}

/* standard error */
div.nboutput.container div.output_area.stderr {
    background: #fdd;
}

/* ANSI colors */
.ansi-black-fg { color: #3E424D; }
.ansi-black-bg { background-color: #3E424D; }
.ansi-black-intense-fg { color: #282C36; }
.ansi-black-intense-bg { background-color: #282C36; }
.ansi-red-fg { color: #E75C58; }
.ansi-red-bg { background-color: #E75C58; }
.ansi-red-intense-fg { color: #B22B31; }
.ansi-red-intense-bg { background-color: #B22B31; }
.ansi-green-fg { color: #00A250; }
.ansi-green-bg { background-color: #00A250; }
.ansi-green-intense-fg { color: #007427; }
.ansi-green-intense-bg { background-color: #007427; }
.ansi-yellow-fg { color: #DDB62B; }
.ansi-yellow-bg { background-color: #DDB62B; }
.ansi-yellow-intense-fg { color: #B27D12; }
.ansi-yellow-intense-bg { background-color: #B27D12; }
.ansi-blue-fg { color: #208FFB; }
.ansi-blue-bg { background-color: #208FFB; }
.ansi-blue-intense-fg { color: #0065CA; }
.ansi-blue-intense-bg { background-color: #0065CA; }
.ansi-magenta-fg { color: #D160C4; }
.ansi-magenta-bg { background-color: #D160C4; }
.ansi-magenta-intense-fg { color: #A03196; }
.ansi-magenta-intense-bg { background-color: #A03196; }
.ansi-cyan-fg { color: #60C6C8; }
.ansi-cyan-bg { background-color: #60C6C8; }
.ansi-cyan-intense-fg { color: #258F8F; }
.ansi-cyan-intense-bg { background-color: #258F8F; }
.ansi-white-fg { color: #C5C1B4; }
.ansi-white-bg { background-color: #C5C1B4; }
.ansi-white-intense-fg { color: #A1A6B2; }
.ansi-white-intense-bg { background-color: #A1A6B2; }

.ansi-default-inverse-fg { color: #FFFFFF; }
.ansi-default-inverse-bg { background-color: #000000; }

.ansi-bold { font-weight: bold; }
.ansi-underline { text-decoration: underline; }


div.nbinput.container div.input_area div[class*=highlight] > pre,
div.nboutput.container div.output_area div[class*=highlight] > pre,
div.nboutput.container div.output_area div[class*=highlight].math,
div.nboutput.container div.output_area.rendered_html,
div.nboutput.container div.output_area > div.output_javascript,
div.nboutput.container div.output_area:not(.rendered_html) > img{
    padding: 5px;
}

/* fix copybtn overflow problem in chromium (needed for 'sphinx_copybutton') */
div.nbinput.container div.input_area > div[class^='highlight'],
div.nboutput.container div.output_area > div[class^='highlight']{
    overflow-y: hidden;
}

/* hide copybtn icon on prompts (needed for 'sphinx_copybutton') */
.prompt a.copybtn {
    display: none;
}

/* Some additional styling taken form the Jupyter notebook CSS */
div.rendered_html table {
  border: none;
  border-collapse: collapse;
  border-spacing: 0;
  color: black;
  font-size: 12px;
  table-layout: fixed;
}
div.rendered_html thead {
  border-bottom: 1px solid black;
  vertical-align: bottom;
}
div.rendered_html tr,
div.rendered_html th,
div.rendered_html td {
  text-align: right;
  vertical-align: middle;
  padding: 0.5em 0.5em;
  line-height: normal;
  white-space: normal;
  max-width: none;
  border: none;
}
div.rendered_html th {
  font-weight: bold;
}
div.rendered_html tbody tr:nth-child(odd) {
  background: #f5f5f5;
}
div.rendered_html tbody tr:hover {
  background: rgba(66, 165, 245, 0.2);
}

/* CSS overrides for sphinx_rtd_theme */

/* 24px margin */
.nbinput.nblast.container,
.nboutput.nblast.container {
    margin-bottom: 19px;  /* padding has already 5px */
}

/* ... except between code cells! */
.nblast.container + .nbinput.container {
    margin-top: -19px;
}

.admonition > p:before {
    margin-right: 4px;  /* make room for the exclamation icon */
}

/* Fix math alignment, see https://github.com/rtfd/sphinx_rtd_theme/pull/686 */
.math {
    text-align: unset;
}
</style>
<div class="admonition note">
<p class="admonition-title">注釈</p>
<p>当ページは <a class="reference external" href="https://github.com/Qiskit/qiskit-tutorials/blob/master/tutorials/circuits_advanced/4_transpiler_passes_and_passmanager.ipynb">tutorials/circuits_advanced/4_transpiler_passes_and_passmanager.ipynb</a> から生成されました。</p>
</div>
<div class="section" id="トランスパイラー-パスとパス-マネージャー">
<h1>トランスパイラー パスとパス マネージャー<a class="headerlink" href="#トランスパイラー-パスとパス-マネージャー" title="このヘッドラインへのパーマリンク">¶</a></h1>
<div class="section" id="はじめに">
<h2>はじめに<a class="headerlink" href="#はじめに" title="このヘッドラインへのパーマリンク">¶</a></h2>
<p>Qiskit Terra の中核コンポーネントはトランスパイラーで、モジュール性と拡張性のために設計されています。目的は新しい回路の変換（トランスパイラー <strong>パス ** と呼んでいます） を簡単に書けるようにし、他の既存のパスと組み合わせられるようにすることです。これらのパスを連鎖させ、どの順番で適用するかは、最終的な結果に大きな影響を与えます。このパイプラインは **パスマネージャー</strong> により決定されます。パスマネージャーは、パスをスケジューリングし、共有スペースによるパス間の相互通信を行えるようにしています。このようにトランスパイラーは、量子回路の積極的な最適化の研究のために、ドアを開放しています。</p>
<p>このノートブックでは、ビルドインされたパスを調べ、パスマネージャの利用法を確認し、簡単なトランスパイラパスを開発します。そのために、最初に有向非巡回グラフ（Directed Acyclic Graph、DAG）の形で、Qiskitにおける量子回路の内部表現を紹介します。次に、入力回路を接続性の制限された量子デバイスと互換性を持つように変換する、単純な swap mapper パスを示します。</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[1]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="o">%</span><span class="k">matplotlib</span> inline
<span class="kn">from</span> <span class="nn">qiskit</span> <span class="kn">import</span> <span class="n">QuantumCircuit</span>
<span class="kn">from</span> <span class="nn">qiskit.compiler</span> <span class="kn">import</span> <span class="n">transpile</span>
<span class="kn">from</span> <span class="nn">qiskit.transpiler</span> <span class="kn">import</span> <span class="n">PassManager</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="パスマネージャーオブジェクト">
<h2>パスマネージャーオブジェクト<a class="headerlink" href="#パスマネージャーオブジェクト" title="このヘッドラインへのパーマリンク">¶</a></h2>
<p>必要なパスのセットが指定できます。</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[2]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">circ</span> <span class="o">=</span> <span class="n">QuantumCircuit</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
<span class="n">circ</span><span class="o">.</span><span class="n">ccx</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
<span class="n">circ</span><span class="o">.</span><span class="n">draw</span><span class="p">(</span><span class="n">output</span><span class="o">=</span><span class="s1">&#39;mpl&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[2]:
</pre></div>
</div>
<div class="output_area docutils container">
<img alt="../../_images/tutorials_circuits_advanced_4_transpiler_passes_and_passmanager_5_0.png" src="../../_images/tutorials_circuits_advanced_4_transpiler_passes_and_passmanager_5_0.png" />
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[3]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="kn">from</span> <span class="nn">qiskit.transpiler.passes</span> <span class="kn">import</span> <span class="n">Unroller</span>
<span class="n">pass_</span> <span class="o">=</span> <span class="n">Unroller</span><span class="p">([</span><span class="s1">&#39;u1&#39;</span><span class="p">,</span> <span class="s1">&#39;u2&#39;</span><span class="p">,</span> <span class="s1">&#39;u3&#39;</span><span class="p">,</span> <span class="s1">&#39;cx&#39;</span><span class="p">])</span>
<span class="n">pm</span> <span class="o">=</span> <span class="n">PassManager</span><span class="p">(</span><span class="n">pass_</span><span class="p">)</span>
<span class="n">new_circ</span> <span class="o">=</span> <span class="n">pm</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">circ</span><span class="p">)</span>
<span class="n">new_circ</span><span class="o">.</span><span class="n">draw</span><span class="p">(</span><span class="n">output</span><span class="o">=</span><span class="s1">&#39;mpl&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[3]:
</pre></div>
</div>
<div class="output_area docutils container">
<img alt="../../_images/tutorials_circuits_advanced_4_transpiler_passes_and_passmanager_6_0.png" src="../../_images/tutorials_circuits_advanced_4_transpiler_passes_and_passmanager_6_0.png" />
</div>
</div>
<p>Qiskit のトランスパイラーパスは、すべて <code class="docutils literal notranslate"><span class="pre">qiskit.transpiler.passes</span></code> から取得できます。</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[4]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="kn">from</span> <span class="nn">qiskit.transpiler</span> <span class="kn">import</span> <span class="n">passes</span>
<span class="p">[</span><span class="n">pass_</span> <span class="k">for</span> <span class="n">pass_</span> <span class="ow">in</span> <span class="nb">dir</span><span class="p">(</span><span class="n">passes</span><span class="p">)</span> <span class="k">if</span> <span class="n">pass_</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">isupper</span><span class="p">()]</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[4]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
[&#39;ApplyLayout&#39;,
 &#39;BarrierBeforeFinalMeasurements&#39;,
 &#39;BasicSwap&#39;,
 &#39;BasisTranslator&#39;,
 &#39;CSPLayout&#39;,
 &#39;CXCancellation&#39;,
 &#39;CXDirection&#39;,
 &#39;CheckCXDirection&#39;,
 &#39;CheckMap&#39;,
 &#39;Collect2qBlocks&#39;,
 &#39;CommutationAnalysis&#39;,
 &#39;CommutativeCancellation&#39;,
 &#39;ConsolidateBlocks&#39;,
 &#39;CountOps&#39;,
 &#39;CountOpsLongestPath&#39;,
 &#39;CrosstalkAdaptiveSchedule&#39;,
 &#39;DAGFixedPoint&#39;,
 &#39;DAGLongestPath&#39;,
 &#39;Decompose&#39;,
 &#39;DenseLayout&#39;,
 &#39;Depth&#39;,
 &#39;EnlargeWithAncilla&#39;,
 &#39;FixedPoint&#39;,
 &#39;FullAncillaAllocation&#39;,
 &#39;HoareOptimizer&#39;,
 &#39;Layout2qDistance&#39;,
 &#39;LayoutTransformation&#39;,
 &#39;LookaheadSwap&#39;,
 &#39;MergeAdjacentBarriers&#39;,
 &#39;NoiseAdaptiveLayout&#39;,
 &#39;NumTensorFactors&#39;,
 &#39;Optimize1qGates&#39;,
 &#39;OptimizeSwapBeforeMeasure&#39;,
 &#39;RemoveDiagonalGatesBeforeMeasure&#39;,
 &#39;RemoveFinalMeasurements&#39;,
 &#39;RemoveResetInZeroState&#39;,
 &#39;ResourceEstimation&#39;,
 &#39;SabreLayout&#39;,
 &#39;SabreSwap&#39;,
 &#39;SetLayout&#39;,
 &#39;Size&#39;,
 &#39;StochasticSwap&#39;,
 &#39;TrivialLayout&#39;,
 &#39;UnitarySynthesis&#39;,
 &#39;Unroll3qOrMore&#39;,
 &#39;UnrollCustomDefinitions&#39;,
 &#39;Unroller&#39;,
 &#39;Width&#39;]
</pre></div></div>
</div>
</div>
<div class="section" id="同じパスの異なる実装">
<h2>同じパスの異なる実装<a class="headerlink" href="#同じパスの異なる実装" title="このヘッドラインへのパーマリンク">¶</a></h2>
<p>同じジョブをこなすパスがあっても、その方法は様々です。例えば、 <code class="docutils literal notranslate"><span class="pre">TrivialLayout</span></code> 、 <code class="docutils literal notranslate"><span class="pre">DenseLayout</span></code> および <code class="docutils literal notranslate"><span class="pre">NoiseAdaptiveLayout</span></code> は、すべてレイアウト（物理量子ビットへの仮想量子ビットのバインド）の選択ですが、それぞれ異なるアルゴリズムや目的を使います。同様に、 <code class="docutils literal notranslate"><span class="pre">BasicSwap</span></code> 、 <code class="docutils literal notranslate"><span class="pre">LookaheadSwap</span></code> および <code class="docutils literal notranslate"><span class="pre">StochasticSwap</span></code> は結合マップに適合するように swap を挿入して回路を作成します。トランスパイラーのモジュール性により、各パスをプラグアンドプレイで置き換えられます。</p>
<p>以下では、swap パスを全て同じ回路、線形鎖トポロジーに適合するように変換しているもの、に適用したものを示しています。パフォーマンスに違いが見られ、明らかに <code class="docutils literal notranslate"><span class="pre">StochasticSwap</span></code> がベストです。しかしながら、入力回路によって違いが現れるでしょう。</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[5]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="kn">from</span> <span class="nn">qiskit.transpiler</span> <span class="kn">import</span> <span class="n">CouplingMap</span><span class="p">,</span> <span class="n">Layout</span>
<span class="kn">from</span> <span class="nn">qiskit.transpiler.passes</span> <span class="kn">import</span> <span class="n">BasicSwap</span><span class="p">,</span> <span class="n">LookaheadSwap</span><span class="p">,</span> <span class="n">StochasticSwap</span>

<span class="n">coupling</span> <span class="o">=</span> <span class="p">[[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">],</span> <span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">],</span> <span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">],</span> <span class="p">[</span><span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">],</span> <span class="p">[</span><span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">]]</span>

<span class="n">circuit</span> <span class="o">=</span> <span class="n">QuantumCircuit</span><span class="p">(</span><span class="mi">7</span><span class="p">)</span>
<span class="n">circuit</span><span class="o">.</span><span class="n">h</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
<span class="n">circuit</span><span class="o">.</span><span class="n">cx</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">6</span><span class="p">)</span>
<span class="n">circuit</span><span class="o">.</span><span class="n">cx</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
<span class="n">circuit</span><span class="o">.</span><span class="n">cx</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">circuit</span><span class="o">.</span><span class="n">cx</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">circuit</span><span class="o">.</span><span class="n">cx</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>

<span class="n">coupling_map</span> <span class="o">=</span> <span class="n">CouplingMap</span><span class="p">(</span><span class="n">couplinglist</span><span class="o">=</span><span class="n">coupling</span><span class="p">)</span>

<span class="n">bs</span> <span class="o">=</span> <span class="n">BasicSwap</span><span class="p">(</span><span class="n">coupling_map</span><span class="o">=</span><span class="n">coupling_map</span><span class="p">)</span>
<span class="n">pass_manager</span> <span class="o">=</span> <span class="n">PassManager</span><span class="p">(</span><span class="n">bs</span><span class="p">)</span>
<span class="n">basic_circ</span> <span class="o">=</span> <span class="n">pass_manager</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">circuit</span><span class="p">)</span>

<span class="n">ls</span> <span class="o">=</span> <span class="n">LookaheadSwap</span><span class="p">(</span><span class="n">coupling_map</span><span class="o">=</span><span class="n">coupling_map</span><span class="p">)</span>
<span class="n">pass_manager</span> <span class="o">=</span> <span class="n">PassManager</span><span class="p">(</span><span class="n">ls</span><span class="p">)</span>
<span class="n">lookahead_circ</span> <span class="o">=</span> <span class="n">pass_manager</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">circuit</span><span class="p">)</span>

<span class="n">ss</span> <span class="o">=</span> <span class="n">StochasticSwap</span><span class="p">(</span><span class="n">coupling_map</span><span class="o">=</span><span class="n">coupling_map</span><span class="p">)</span>
<span class="n">pass_manager</span> <span class="o">=</span> <span class="n">PassManager</span><span class="p">(</span><span class="n">ss</span><span class="p">)</span>
<span class="n">stochastic_circ</span> <span class="o">=</span> <span class="n">pass_manager</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">circuit</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[6]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">circuit</span><span class="o">.</span><span class="n">draw</span><span class="p">(</span><span class="n">output</span><span class="o">=</span><span class="s1">&#39;mpl&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[6]:
</pre></div>
</div>
<div class="output_area docutils container">
<img alt="../../_images/tutorials_circuits_advanced_4_transpiler_passes_and_passmanager_11_0.png" src="../../_images/tutorials_circuits_advanced_4_transpiler_passes_and_passmanager_11_0.png" />
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[7]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">basic_circ</span><span class="o">.</span><span class="n">draw</span><span class="p">(</span><span class="n">output</span><span class="o">=</span><span class="s1">&#39;mpl&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[7]:
</pre></div>
</div>
<div class="output_area docutils container">
<img alt="../../_images/tutorials_circuits_advanced_4_transpiler_passes_and_passmanager_12_0.png" src="../../_images/tutorials_circuits_advanced_4_transpiler_passes_and_passmanager_12_0.png" />
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[8]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">lookahead_circ</span><span class="o">.</span><span class="n">draw</span><span class="p">(</span><span class="n">output</span><span class="o">=</span><span class="s1">&#39;mpl&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[8]:
</pre></div>
</div>
<div class="output_area docutils container">
<img alt="../../_images/tutorials_circuits_advanced_4_transpiler_passes_and_passmanager_13_0.png" src="../../_images/tutorials_circuits_advanced_4_transpiler_passes_and_passmanager_13_0.png" />
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[9]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">stochastic_circ</span><span class="o">.</span><span class="n">draw</span><span class="p">(</span><span class="n">output</span><span class="o">=</span><span class="s1">&#39;mpl&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[9]:
</pre></div>
</div>
<div class="output_area docutils container">
<img alt="../../_images/tutorials_circuits_advanced_4_transpiler_passes_and_passmanager_14_0.png" src="../../_images/tutorials_circuits_advanced_4_transpiler_passes_and_passmanager_14_0.png" />
</div>
</div>
</div>
<div class="section" id="プリセット-パスマネージャ">
<h2>プリセット パスマネージャ<a class="headerlink" href="#プリセット-パスマネージャ" title="このヘッドラインへのパーマリンク">¶</a></h2>
<p>Qiskit には既定のパスマネージャを用意しており、異なるパスのパイプラインを通じて達成される様々な最適化レベルに対応しています。現時点で <code class="docutils literal notranslate"><span class="pre">optimization_level</span></code> は 0 から 3 までサポートされており、一番大きな数字はより最適化されますが、一方で時間を消費します。トランスパイルされる回路とターゲットとなるバックエンドに非常に依存するので、最適なパスマネージャの選択は試行錯誤を繰り返します。</p>
<p>ここでは、異なるレベルの結果を状態合成 (state synthesis) 回路で見てみたいと思います。４つの量子ビットを任意の状態で初期化し、これを実現する回路を最適化します。</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">optimization_level=0</span></code> : 明示的な最適化をせず回路をバックエンドにマップします(どの最適化でもマッパーが実施する項目を除く)。</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">optimization_level=1</span></code> : 回路をマップしますが、隣接するゲートをつぶすといった軽量の最適化を実施します。</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">optimization_level=2</span></code> : 中程度の最適化で、ノイズに適応したレイアウト、ゲートの交換関係に基づくゲートキャンセル処理が含まれます。</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">optimization_level=3</span></code> : 重量な最適化で、前までのステップに加え、回路にある２量子ビットの再合成 (resynthesis) を実施します。</p></li>
</ul>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[10]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="kn">import</span> <span class="nn">math</span>
<span class="kn">from</span> <span class="nn">qiskit.test.mock</span> <span class="kn">import</span> <span class="n">FakeTokyo</span>

<span class="n">backend</span> <span class="o">=</span> <span class="n">FakeTokyo</span><span class="p">()</span>     <span class="c1"># mimics the tokyo device in terms of coupling map and basis gates</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[11]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">qc</span> <span class="o">=</span> <span class="n">QuantumCircuit</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>

<span class="n">random_state</span> <span class="o">=</span> <span class="p">[</span>
    <span class="mi">1</span> <span class="o">/</span> <span class="n">math</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span> <span class="o">*</span> <span class="nb">complex</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>
    <span class="mi">1</span> <span class="o">/</span> <span class="n">math</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">8</span><span class="p">)</span> <span class="o">*</span> <span class="nb">complex</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
    <span class="mi">0</span><span class="p">,</span>
    <span class="mi">0</span><span class="p">,</span>
    <span class="mi">0</span><span class="p">,</span>
    <span class="mi">0</span><span class="p">,</span>
    <span class="mi">0</span><span class="p">,</span>
    <span class="mi">0</span><span class="p">,</span>
    <span class="mi">1</span> <span class="o">/</span> <span class="n">math</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">8</span><span class="p">)</span> <span class="o">*</span> <span class="nb">complex</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
    <span class="mi">1</span> <span class="o">/</span> <span class="n">math</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">8</span><span class="p">)</span> <span class="o">*</span> <span class="nb">complex</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>
    <span class="mi">0</span><span class="p">,</span>
    <span class="mi">0</span><span class="p">,</span>
    <span class="mi">0</span><span class="p">,</span>
    <span class="mi">0</span><span class="p">,</span>
    <span class="mi">1</span> <span class="o">/</span> <span class="n">math</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span> <span class="o">*</span> <span class="nb">complex</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
    <span class="mi">1</span> <span class="o">/</span> <span class="n">math</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">8</span><span class="p">)</span> <span class="o">*</span> <span class="nb">complex</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">)]</span>

<span class="n">qc</span><span class="o">.</span><span class="n">initialize</span><span class="p">(</span><span class="n">random_state</span><span class="p">,</span> <span class="nb">range</span><span class="p">(</span><span class="mi">4</span><span class="p">))</span>
<span class="n">qc</span><span class="o">.</span><span class="n">draw</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[11]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<pre style="word-wrap: normal;white-space: pre;background: #fff0;line-height: 1.1;font-family: &quot;Courier New&quot;,Courier,monospace">     »
q_0: »
     »
q_1: »
     »
q_2: »
     »
q_3: »
     »
q_4: »
     »
q_5: »
     »
q_6: »
     »
q_7: »
     »
q_8: »
     »
q_9: »
     »
«     ┌────────────────────────────────────────────────────────────────────────────┐
«q_0: ┤0                                                                           ├
«     │                                                                            │
«q_1: ┤1                                                                           ├
«     │  initialize(0.5j,0.35355,0,0,0,0,0,0,0.35355,0.35355j,0,0,0,0,0.5,0.35355) │
«q_2: ┤2                                                                           ├
«     │                                                                            │
«q_3: ┤3                                                                           ├
«     └────────────────────────────────────────────────────────────────────────────┘
«q_4: ──────────────────────────────────────────────────────────────────────────────
«
«q_5: ──────────────────────────────────────────────────────────────────────────────
«
«q_6: ──────────────────────────────────────────────────────────────────────────────
«
«q_7: ──────────────────────────────────────────────────────────────────────────────
«
«q_8: ──────────────────────────────────────────────────────────────────────────────
«
«q_9: ──────────────────────────────────────────────────────────────────────────────
«                                                                                   </pre></div>
</div>
<p>では、これを異なる最適化レベルで20量子ビットの Tokyo デバイスにマップします。</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[12]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">optimized_0</span> <span class="o">=</span> <span class="n">transpile</span><span class="p">(</span><span class="n">qc</span><span class="p">,</span> <span class="n">backend</span><span class="o">=</span><span class="n">backend</span><span class="p">,</span> <span class="n">seed_transpiler</span><span class="o">=</span><span class="mi">11</span><span class="p">,</span> <span class="n">optimization_level</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;gates = &#39;</span><span class="p">,</span> <span class="n">optimized_0</span><span class="o">.</span><span class="n">count_ops</span><span class="p">())</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;depth = &#39;</span><span class="p">,</span> <span class="n">optimized_0</span><span class="o">.</span><span class="n">depth</span><span class="p">())</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
gates =  OrderedDict([(&#39;cx&#39;, 55), (&#39;u3&#39;, 15), (&#39;u1&#39;, 15), (&#39;reset&#39;, 4)])
depth =  69
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[13]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">optimized_1</span> <span class="o">=</span> <span class="n">transpile</span><span class="p">(</span><span class="n">qc</span><span class="p">,</span> <span class="n">backend</span><span class="o">=</span><span class="n">backend</span><span class="p">,</span> <span class="n">seed_transpiler</span><span class="o">=</span><span class="mi">11</span><span class="p">,</span> <span class="n">optimization_level</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;gates = &#39;</span><span class="p">,</span> <span class="n">optimized_1</span><span class="o">.</span><span class="n">count_ops</span><span class="p">())</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;depth = &#39;</span><span class="p">,</span> <span class="n">optimized_1</span><span class="o">.</span><span class="n">depth</span><span class="p">())</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
gates =  OrderedDict([(&#39;cx&#39;, 55), (&#39;u3&#39;, 15), (&#39;u1&#39;, 7)])
depth =  60
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[14]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">optimized_2</span> <span class="o">=</span> <span class="n">transpile</span><span class="p">(</span><span class="n">qc</span><span class="p">,</span> <span class="n">backend</span><span class="o">=</span><span class="n">backend</span><span class="p">,</span> <span class="n">seed_transpiler</span><span class="o">=</span><span class="mi">11</span><span class="p">,</span> <span class="n">optimization_level</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;gates = &#39;</span><span class="p">,</span> <span class="n">optimized_2</span><span class="o">.</span><span class="n">count_ops</span><span class="p">())</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;depth = &#39;</span><span class="p">,</span> <span class="n">optimized_2</span><span class="o">.</span><span class="n">depth</span><span class="p">())</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
gates =  OrderedDict([(&#39;cx&#39;, 45), (&#39;u3&#39;, 15), (&#39;u1&#39;, 7)])
depth =  56
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[15]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">optimized_3</span> <span class="o">=</span> <span class="n">transpile</span><span class="p">(</span><span class="n">qc</span><span class="p">,</span> <span class="n">backend</span><span class="o">=</span><span class="n">backend</span><span class="p">,</span> <span class="n">seed_transpiler</span><span class="o">=</span><span class="mi">11</span><span class="p">,</span> <span class="n">optimization_level</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;gates = &#39;</span><span class="p">,</span> <span class="n">optimized_3</span><span class="o">.</span><span class="n">count_ops</span><span class="p">())</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;depth = &#39;</span><span class="p">,</span> <span class="n">optimized_3</span><span class="o">.</span><span class="n">depth</span><span class="p">())</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
gates =  OrderedDict([(&#39;cx&#39;, 20), (&#39;u3&#39;, 15), (&#39;u1&#39;, 7)])
depth =  39
</pre></div></div>
</div>
</div>
<div class="section" id="DAGの紹介">
<h2>DAGの紹介<a class="headerlink" href="#DAGの紹介" title="このヘッドラインへのパーマリンク">¶</a></h2>
<p>Qiskit では、回路の表現として有向非巡回グラフ( Directed Acyclic Graph - DAG) を内部的に使用しています。純粋なゲートのリスト（つまり <em>netlist</em> ) に比べてこの表現の利点は、操作間の情報のフローが明示的になり、回路のセマンティックを変更することなくパスが変換の決定をするのにより容易である点です。</p>
<p>簡単な回路を構築して、DAG を調べてみましょう。</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[16]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="kn">from</span> <span class="nn">qiskit</span> <span class="kn">import</span> <span class="n">QuantumRegister</span><span class="p">,</span> <span class="n">ClassicalRegister</span><span class="p">,</span> <span class="n">QuantumCircuit</span>
<span class="kn">from</span> <span class="nn">qiskit.dagcircuit</span> <span class="kn">import</span> <span class="n">DAGCircuit</span>
<span class="n">q</span> <span class="o">=</span> <span class="n">QuantumRegister</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="s1">&#39;q&#39;</span><span class="p">)</span>
<span class="n">c</span> <span class="o">=</span> <span class="n">ClassicalRegister</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="s1">&#39;c&#39;</span><span class="p">)</span>
<span class="n">circ</span> <span class="o">=</span> <span class="n">QuantumCircuit</span><span class="p">(</span><span class="n">q</span><span class="p">,</span> <span class="n">c</span><span class="p">)</span>
<span class="n">circ</span><span class="o">.</span><span class="n">h</span><span class="p">(</span><span class="n">q</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
<span class="n">circ</span><span class="o">.</span><span class="n">cx</span><span class="p">(</span><span class="n">q</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">q</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
<span class="n">circ</span><span class="o">.</span><span class="n">measure</span><span class="p">(</span><span class="n">q</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">c</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
<span class="n">circ</span><span class="o">.</span><span class="n">rz</span><span class="p">(</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">q</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span><span class="o">.</span><span class="n">c_if</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
<span class="n">circ</span><span class="o">.</span><span class="n">draw</span><span class="p">(</span><span class="n">output</span><span class="o">=</span><span class="s1">&#39;mpl&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[16]:
</pre></div>
</div>
<div class="output_area docutils container">
<img alt="../../_images/tutorials_circuits_advanced_4_transpiler_passes_and_passmanager_25_0.png" src="../../_images/tutorials_circuits_advanced_4_transpiler_passes_and_passmanager_25_0.png" />
</div>
</div>
<p>DAGには、３種類のグラフノードがあります：qubit/clbit インプットノード(緑)、操作ノード(青)、及びアウトプットノード(赤) です。各エッジはノード間のデータの流れ(もしくは依存性) を示しています。</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[17]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="kn">from</span> <span class="nn">qiskit.converters</span> <span class="kn">import</span> <span class="n">circuit_to_dag</span>
<span class="kn">from</span> <span class="nn">qiskit.tools.visualization</span> <span class="kn">import</span> <span class="n">dag_drawer</span>
<span class="n">dag</span> <span class="o">=</span> <span class="n">circuit_to_dag</span><span class="p">(</span><span class="n">circ</span><span class="p">)</span>
<span class="n">dag_drawer</span><span class="p">(</span><span class="n">dag</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[17]:
</pre></div>
</div>
<div class="output_area docutils container">
<img alt="../../_images/tutorials_circuits_advanced_4_transpiler_passes_and_passmanager_27_0.png" src="../../_images/tutorials_circuits_advanced_4_transpiler_passes_and_passmanager_27_0.png" />
</div>
</div>
<p>従って、トランスパイラーのパスを実装するということは、Qiskit の DAGCircuit API を利用して分析し、回路を変換するということを意味します。幾つかの例を見てみましょう。</p>
<p><strong>a. DAG中の全ての操作ノードを取得します:</strong></p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[18]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">dag</span><span class="o">.</span><span class="n">op_nodes</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[18]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
[&lt;qiskit.dagcircuit.dagnode.DAGNode at 0x1399a7350&gt;,
 &lt;qiskit.dagcircuit.dagnode.DAGNode at 0x1399a7050&gt;,
 &lt;qiskit.dagcircuit.dagnode.DAGNode at 0x1399a78d0&gt;,
 &lt;qiskit.dagcircuit.dagnode.DAGNode at 0x1399a7950&gt;]
</pre></div></div>
</div>
<p>各ノードは <code class="docutils literal notranslate"><span class="pre">DAGNode</span></code> クラスのインスタンスです。２つ目の操作ノードに含まれる情報を確認しましょう。</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[19]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">node</span> <span class="o">=</span> <span class="n">dag</span><span class="o">.</span><span class="n">op_nodes</span><span class="p">()[</span><span class="mi">3</span><span class="p">]</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;node name: &quot;</span><span class="p">,</span> <span class="n">node</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;node op: &quot;</span><span class="p">,</span> <span class="n">node</span><span class="o">.</span><span class="n">op</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;node qargs: &quot;</span><span class="p">,</span> <span class="n">node</span><span class="o">.</span><span class="n">qargs</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;node cargs: &quot;</span><span class="p">,</span> <span class="n">node</span><span class="o">.</span><span class="n">cargs</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;node condition: &quot;</span><span class="p">,</span> <span class="n">node</span><span class="o">.</span><span class="n">condition</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
node name:  rz
node op:  &lt;qiskit.circuit.library.standard_gates.rz.RZGate object at 0x13918de10&gt;
node qargs:  [Qubit(QuantumRegister(3, &#39;q&#39;), 1)]
node cargs:  []
node condition:  (ClassicalRegister(3, &#39;c&#39;), 2)
</pre></div></div>
</div>
<p><strong>b. 後ろに操作を追加します:</strong></p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[20]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="kn">from</span> <span class="nn">qiskit.circuit.library</span> <span class="kn">import</span> <span class="n">HGate</span>
<span class="n">dag</span><span class="o">.</span><span class="n">apply_operation_back</span><span class="p">(</span><span class="n">HGate</span><span class="p">(),</span> <span class="n">qargs</span><span class="o">=</span><span class="p">[</span><span class="n">q</span><span class="p">[</span><span class="mi">0</span><span class="p">]])</span>
<span class="n">dag_drawer</span><span class="p">(</span><span class="n">dag</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[20]:
</pre></div>
</div>
<div class="output_area docutils container">
<img alt="../../_images/tutorials_circuits_advanced_4_transpiler_passes_and_passmanager_34_0.png" src="../../_images/tutorials_circuits_advanced_4_transpiler_passes_and_passmanager_34_0.png" />
</div>
</div>
<p><strong>c. 前に操作を追加します:</strong></p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[21]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="kn">from</span> <span class="nn">qiskit.circuit.library</span> <span class="kn">import</span> <span class="n">CCXGate</span>
<span class="n">dag</span><span class="o">.</span><span class="n">apply_operation_front</span><span class="p">(</span><span class="n">CCXGate</span><span class="p">(),</span> <span class="n">qargs</span><span class="o">=</span><span class="p">[</span><span class="n">q</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">q</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">q</span><span class="p">[</span><span class="mi">2</span><span class="p">]],</span> <span class="n">cargs</span><span class="o">=</span><span class="p">[])</span>
<span class="n">dag_drawer</span><span class="p">(</span><span class="n">dag</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[21]:
</pre></div>
</div>
<div class="output_area docutils container">
<img alt="../../_images/tutorials_circuits_advanced_4_transpiler_passes_and_passmanager_36_0.png" src="../../_images/tutorials_circuits_advanced_4_transpiler_passes_and_passmanager_36_0.png" />
</div>
</div>
<p><strong>d. ノードをサブ回路で置き換えます:</strong></p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[22]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="kn">from</span> <span class="nn">qiskit.circuit.library</span> <span class="kn">import</span> <span class="n">CHGate</span><span class="p">,</span> <span class="n">U2Gate</span><span class="p">,</span> <span class="n">CXGate</span>
<span class="n">mini_dag</span> <span class="o">=</span> <span class="n">DAGCircuit</span><span class="p">()</span>
<span class="n">p</span> <span class="o">=</span> <span class="n">QuantumRegister</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="s2">&quot;p&quot;</span><span class="p">)</span>
<span class="n">mini_dag</span><span class="o">.</span><span class="n">add_qreg</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>
<span class="n">mini_dag</span><span class="o">.</span><span class="n">apply_operation_back</span><span class="p">(</span><span class="n">CHGate</span><span class="p">(),</span> <span class="n">qargs</span><span class="o">=</span><span class="p">[</span><span class="n">p</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">p</span><span class="p">[</span><span class="mi">0</span><span class="p">]])</span>
<span class="n">mini_dag</span><span class="o">.</span><span class="n">apply_operation_back</span><span class="p">(</span><span class="n">U2Gate</span><span class="p">(</span><span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.2</span><span class="p">),</span> <span class="n">qargs</span><span class="o">=</span><span class="p">[</span><span class="n">p</span><span class="p">[</span><span class="mi">1</span><span class="p">]])</span>

<span class="c1"># substitute the cx node with the above mini-dag</span>
<span class="n">cx_node</span> <span class="o">=</span> <span class="n">dag</span><span class="o">.</span><span class="n">op_nodes</span><span class="p">(</span><span class="n">op</span><span class="o">=</span><span class="n">CXGate</span><span class="p">)</span><span class="o">.</span><span class="n">pop</span><span class="p">()</span>
<span class="n">dag</span><span class="o">.</span><span class="n">substitute_node_with_dag</span><span class="p">(</span><span class="n">node</span><span class="o">=</span><span class="n">cx_node</span><span class="p">,</span> <span class="n">input_dag</span><span class="o">=</span><span class="n">mini_dag</span><span class="p">,</span> <span class="n">wires</span><span class="o">=</span><span class="p">[</span><span class="n">p</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">p</span><span class="p">[</span><span class="mi">1</span><span class="p">]])</span>
<span class="n">dag_drawer</span><span class="p">(</span><span class="n">dag</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[22]:
</pre></div>
</div>
<div class="output_area docutils container">
<img alt="../../_images/tutorials_circuits_advanced_4_transpiler_passes_and_passmanager_38_0.png" src="../../_images/tutorials_circuits_advanced_4_transpiler_passes_and_passmanager_38_0.png" />
</div>
</div>
<p>最後に、全ての変換が完了した後に、通常の QuantumCircuit オブジェクトに戻すことができます。これがトランスパイラーは実施していることです！ 回路を受け取り、DAG 形式で操作し、変換した回路を出力します。</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[23]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="kn">from</span> <span class="nn">qiskit.converters</span> <span class="kn">import</span> <span class="n">dag_to_circuit</span>
<span class="n">circuit</span> <span class="o">=</span> <span class="n">dag_to_circuit</span><span class="p">(</span><span class="n">dag</span><span class="p">)</span>
<span class="n">circuit</span><span class="o">.</span><span class="n">draw</span><span class="p">(</span><span class="n">output</span><span class="o">=</span><span class="s1">&#39;mpl&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[23]:
</pre></div>
</div>
<div class="output_area docutils container">
<img alt="../../_images/tutorials_circuits_advanced_4_transpiler_passes_and_passmanager_40_0.png" src="../../_images/tutorials_circuits_advanced_4_transpiler_passes_and_passmanager_40_0.png" />
</div>
</div>
</div>
<div class="section" id="BasicMapper-パスを実装してみる">
<h2>BasicMapper パスを実装してみる<a class="headerlink" href="#BasicMapper-パスを実装してみる" title="このヘッドラインへのパーマリンク">¶</a></h2>
<p>DAG について理解できたので、トランスパイラーパスを書いてみましょう。ここでは、限られた量子ビット接続でのデバイスに対して任意の回路をマッピングする基本的なパスを実装します。これを BasicMapper と呼ぶことにします。このパスは、Qiskit Terra に含まれています。</p>
<p>トランスパイラーパスを作成する時に最初にやらなければいけないことは、パスクラスを <code class="docutils literal notranslate"><span class="pre">TransformationPass</span></code> か <code class="docutils literal notranslate"><span class="pre">AnalysisPass</span></code> のどちらから派生させるかを決定することです。Transformationパス は回路を修正しますが、Analysisパス は回路の情報を収集する(のちに別のパスで利用される) のみです。次に、メインタスクとなる <code class="docutils literal notranslate"><span class="pre">run(dag)</span></code> メソッドを実装します。最後に、 <code class="docutils literal notranslate"><span class="pre">qiskit.transpiler.passes</span></code> モジュールの内部に登録させます。</p>
<p>このパスは以下のように機能します：DAG をレイヤー毎に横断します(各レイヤーは独立した量子ビットに作用しない操作のグループで、理論的にはレイヤーに存在する操作は独立して実行できます)。各操作に対して、既にカップリングマップの制約に適合していない場合には、パスは swap パスを特定し、２つの量子ビットが近くなるように swap を追加していきます。</p>
<p>詳細はコード中のコメントを参照してください。</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[24]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="kn">from</span> <span class="nn">copy</span> <span class="kn">import</span> <span class="n">copy</span>

<span class="kn">from</span> <span class="nn">qiskit.transpiler.basepasses</span> <span class="kn">import</span> <span class="n">TransformationPass</span>
<span class="kn">from</span> <span class="nn">qiskit.transpiler</span> <span class="kn">import</span> <span class="n">Layout</span>
<span class="kn">from</span> <span class="nn">qiskit.circuit.library</span> <span class="kn">import</span> <span class="n">SwapGate</span>


<span class="k">class</span> <span class="nc">BasicSwap</span><span class="p">(</span><span class="n">TransformationPass</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Maps (with minimum effort) a DAGCircuit onto a `coupling_map` adding swap gates.&quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                 <span class="n">coupling_map</span><span class="p">,</span>
                 <span class="n">initial_layout</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Maps a DAGCircuit onto a `coupling_map` using swap gates.</span>

<span class="sd">        Args:</span>
<span class="sd">            coupling_map (CouplingMap): Directed graph represented a coupling map.</span>
<span class="sd">            initial_layout (Layout): initial layout of qubits in mapping</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">coupling_map</span> <span class="o">=</span> <span class="n">coupling_map</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">initial_layout</span> <span class="o">=</span> <span class="n">initial_layout</span>

    <span class="k">def</span> <span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dag</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Runs the BasicSwap pass on `dag`.</span>

<span class="sd">        Args:</span>
<span class="sd">            dag (DAGCircuit): DAG to map.</span>

<span class="sd">        Returns:</span>
<span class="sd">            DAGCircuit: A mapped DAG.</span>

<span class="sd">        Raises:</span>
<span class="sd">            TranspilerError: if the coupling map or the layout are not</span>
<span class="sd">            compatible with the DAG</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">new_dag</span> <span class="o">=</span> <span class="n">DAGCircuit</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">qreg</span> <span class="ow">in</span> <span class="n">dag</span><span class="o">.</span><span class="n">qregs</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
            <span class="n">new_dag</span><span class="o">.</span><span class="n">add_qreg</span><span class="p">(</span><span class="n">qreg</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">creg</span> <span class="ow">in</span> <span class="n">dag</span><span class="o">.</span><span class="n">cregs</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
            <span class="n">new_dag</span><span class="o">.</span><span class="n">add_creg</span><span class="p">(</span><span class="n">creg</span><span class="p">)</span>


        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">initial_layout</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">property_set</span><span class="p">[</span><span class="s2">&quot;layout&quot;</span><span class="p">]:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">initial_layout</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">property_set</span><span class="p">[</span><span class="s2">&quot;layout&quot;</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">initial_layout</span> <span class="o">=</span> <span class="n">Layout</span><span class="o">.</span><span class="n">generate_trivial_layout</span><span class="p">(</span><span class="o">*</span><span class="n">dag</span><span class="o">.</span><span class="n">qregs</span><span class="o">.</span><span class="n">values</span><span class="p">())</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">dag</span><span class="o">.</span><span class="n">qubits</span><span class="p">())</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">initial_layout</span><span class="p">):</span>
            <span class="k">raise</span> <span class="n">TranspilerError</span><span class="p">(</span><span class="s1">&#39;The layout does not match the amount of qubits in the DAG&#39;</span><span class="p">)</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">coupling_map</span><span class="o">.</span><span class="n">physical_qubits</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">initial_layout</span><span class="p">):</span>
            <span class="k">raise</span> <span class="n">TranspilerError</span><span class="p">(</span>
                <span class="s2">&quot;Mappers require to have the layout to be the same size as the coupling map&quot;</span><span class="p">)</span>

        <span class="n">canonical_register</span> <span class="o">=</span> <span class="n">dag</span><span class="o">.</span><span class="n">qregs</span><span class="p">[</span><span class="s1">&#39;q&#39;</span><span class="p">]</span>
        <span class="n">trivial_layout</span> <span class="o">=</span> <span class="n">Layout</span><span class="o">.</span><span class="n">generate_trivial_layout</span><span class="p">(</span><span class="n">canonical_register</span><span class="p">)</span>
        <span class="n">current_layout</span> <span class="o">=</span> <span class="n">trivial_layout</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>

        <span class="k">for</span> <span class="n">layer</span> <span class="ow">in</span> <span class="n">dag</span><span class="o">.</span><span class="n">serial_layers</span><span class="p">():</span>
            <span class="n">subdag</span> <span class="o">=</span> <span class="n">layer</span><span class="p">[</span><span class="s1">&#39;graph&#39;</span><span class="p">]</span>

            <span class="k">for</span> <span class="n">gate</span> <span class="ow">in</span> <span class="n">subdag</span><span class="o">.</span><span class="n">two_qubit_ops</span><span class="p">():</span>
                <span class="n">physical_q0</span> <span class="o">=</span> <span class="n">current_layout</span><span class="p">[</span><span class="n">gate</span><span class="o">.</span><span class="n">qargs</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span>
                <span class="n">physical_q1</span> <span class="o">=</span> <span class="n">current_layout</span><span class="p">[</span><span class="n">gate</span><span class="o">.</span><span class="n">qargs</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">coupling_map</span><span class="o">.</span><span class="n">distance</span><span class="p">(</span><span class="n">physical_q0</span><span class="p">,</span> <span class="n">physical_q1</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">:</span>
                    <span class="c1"># Insert a new layer with the SWAP(s).</span>
                    <span class="n">swap_layer</span> <span class="o">=</span> <span class="n">DAGCircuit</span><span class="p">()</span>

                    <span class="n">path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">coupling_map</span><span class="o">.</span><span class="n">shortest_undirected_path</span><span class="p">(</span><span class="n">physical_q0</span><span class="p">,</span> <span class="n">physical_q1</span><span class="p">)</span>
                    <span class="k">for</span> <span class="n">swap</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">path</span><span class="p">)</span> <span class="o">-</span> <span class="mi">2</span><span class="p">):</span>
                        <span class="n">connected_wire_1</span> <span class="o">=</span> <span class="n">path</span><span class="p">[</span><span class="n">swap</span><span class="p">]</span>
                        <span class="n">connected_wire_2</span> <span class="o">=</span> <span class="n">path</span><span class="p">[</span><span class="n">swap</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span>

                        <span class="n">qubit_1</span> <span class="o">=</span> <span class="n">current_layout</span><span class="p">[</span><span class="n">connected_wire_1</span><span class="p">]</span>
                        <span class="n">qubit_2</span> <span class="o">=</span> <span class="n">current_layout</span><span class="p">[</span><span class="n">connected_wire_2</span><span class="p">]</span>

                        <span class="c1"># create qregs</span>
                        <span class="k">for</span> <span class="n">qreg</span> <span class="ow">in</span> <span class="n">current_layout</span><span class="o">.</span><span class="n">get_registers</span><span class="p">():</span>
                            <span class="k">if</span> <span class="n">qreg</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">swap_layer</span><span class="o">.</span><span class="n">qregs</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
                                <span class="n">swap_layer</span><span class="o">.</span><span class="n">add_qreg</span><span class="p">(</span><span class="n">qreg</span><span class="p">)</span>

                        <span class="c1"># create the swap operation</span>
                        <span class="n">swap_layer</span><span class="o">.</span><span class="n">apply_operation_back</span><span class="p">(</span><span class="n">SwapGate</span><span class="p">(),</span>
                                                        <span class="n">qargs</span><span class="o">=</span><span class="p">[</span><span class="n">qubit_1</span><span class="p">,</span> <span class="n">qubit_2</span><span class="p">],</span>
                                                        <span class="n">cargs</span><span class="o">=</span><span class="p">[])</span>

                    <span class="c1"># layer insertion</span>
                    <span class="n">order</span> <span class="o">=</span> <span class="n">current_layout</span><span class="o">.</span><span class="n">reorder_bits</span><span class="p">(</span><span class="n">new_dag</span><span class="o">.</span><span class="n">qubits</span><span class="p">)</span>
                    <span class="n">new_dag</span><span class="o">.</span><span class="n">compose</span><span class="p">(</span><span class="n">swap_layer</span><span class="p">,</span> <span class="n">qubits</span><span class="o">=</span><span class="n">order</span><span class="p">)</span>

                    <span class="c1"># update current_layout</span>
                    <span class="k">for</span> <span class="n">swap</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">path</span><span class="p">)</span> <span class="o">-</span> <span class="mi">2</span><span class="p">):</span>
                        <span class="n">current_layout</span><span class="o">.</span><span class="n">swap</span><span class="p">(</span><span class="n">path</span><span class="p">[</span><span class="n">swap</span><span class="p">],</span> <span class="n">path</span><span class="p">[</span><span class="n">swap</span> <span class="o">+</span> <span class="mi">1</span><span class="p">])</span>

            <span class="n">order</span> <span class="o">=</span> <span class="n">current_layout</span><span class="o">.</span><span class="n">reorder_bits</span><span class="p">(</span><span class="n">new_dag</span><span class="o">.</span><span class="n">qubits</span><span class="p">)</span>
            <span class="n">new_dag</span><span class="o">.</span><span class="n">compose</span><span class="p">(</span><span class="n">subdag</span><span class="p">,</span> <span class="n">qubits</span><span class="o">=</span><span class="n">order</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">new_dag</span>
</pre></div>
</div>
</div>
<p>このパスを小さな回路例で試してみましょう。</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[25]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">q</span> <span class="o">=</span> <span class="n">QuantumRegister</span><span class="p">(</span><span class="mi">7</span><span class="p">,</span> <span class="s1">&#39;q&#39;</span><span class="p">)</span>
<span class="n">in_circ</span> <span class="o">=</span> <span class="n">QuantumCircuit</span><span class="p">(</span><span class="n">q</span><span class="p">)</span>
<span class="n">in_circ</span><span class="o">.</span><span class="n">h</span><span class="p">(</span><span class="n">q</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
<span class="n">in_circ</span><span class="o">.</span><span class="n">cx</span><span class="p">(</span><span class="n">q</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">q</span><span class="p">[</span><span class="mi">4</span><span class="p">])</span>
<span class="n">in_circ</span><span class="o">.</span><span class="n">cx</span><span class="p">(</span><span class="n">q</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">q</span><span class="p">[</span><span class="mi">3</span><span class="p">])</span>
<span class="n">in_circ</span><span class="o">.</span><span class="n">cx</span><span class="p">(</span><span class="n">q</span><span class="p">[</span><span class="mi">6</span><span class="p">],</span> <span class="n">q</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
<span class="n">in_circ</span><span class="o">.</span><span class="n">cx</span><span class="p">(</span><span class="n">q</span><span class="p">[</span><span class="mi">5</span><span class="p">],</span> <span class="n">q</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
<span class="n">in_circ</span><span class="o">.</span><span class="n">rz</span><span class="p">(</span><span class="mf">0.1</span><span class="p">,</span> <span class="n">q</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
<span class="n">in_circ</span><span class="o">.</span><span class="n">cx</span><span class="p">(</span><span class="n">q</span><span class="p">[</span><span class="mi">5</span><span class="p">],</span> <span class="n">q</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[25]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
&lt;qiskit.circuit.instructionset.InstructionSet at 0x139dda290&gt;
</pre></div></div>
</div>
<p>我々の新しいパスを含むパスマネージャーを構築します。上記の回路例をこのパスマネージャに渡し、変換された新しい回路を受け取ります。</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[26]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="kn">from</span> <span class="nn">qiskit.transpiler</span> <span class="kn">import</span> <span class="n">PassManager</span>
<span class="kn">from</span> <span class="nn">qiskit.transpiler</span> <span class="kn">import</span> <span class="n">CouplingMap</span>
<span class="kn">from</span> <span class="nn">qiskit</span> <span class="kn">import</span> <span class="n">BasicAer</span>
<span class="n">pm</span> <span class="o">=</span> <span class="n">PassManager</span><span class="p">()</span>
<span class="n">coupling</span> <span class="o">=</span> <span class="p">[[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">],</span> <span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">],</span> <span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">],</span> <span class="p">[</span><span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">],</span> <span class="p">[</span><span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">]]</span>
<span class="n">coupling_map</span> <span class="o">=</span> <span class="n">CouplingMap</span><span class="p">(</span><span class="n">couplinglist</span><span class="o">=</span><span class="n">coupling</span><span class="p">)</span>

<span class="n">pm</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">BasicSwap</span><span class="p">(</span><span class="n">coupling_map</span><span class="p">)])</span>

<span class="n">out_circ</span> <span class="o">=</span> <span class="n">pm</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">in_circ</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
/Users/jul/Envs/latest/lib/python3.7/site-packages/ipykernel_launcher.py:50: DeprecationWarning: dag.qubits() and dag.clbits() are no longer methods. Use dag.qubits and dag.clbits properties instead.
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[27]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">in_circ</span><span class="o">.</span><span class="n">draw</span><span class="p">(</span><span class="n">output</span><span class="o">=</span><span class="s1">&#39;mpl&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[27]:
</pre></div>
</div>
<div class="output_area docutils container">
<img alt="../../_images/tutorials_circuits_advanced_4_transpiler_passes_and_passmanager_48_0.png" src="../../_images/tutorials_circuits_advanced_4_transpiler_passes_and_passmanager_48_0.png" />
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[28]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">out_circ</span><span class="o">.</span><span class="n">draw</span><span class="p">(</span><span class="n">output</span><span class="o">=</span><span class="s1">&#39;mpl&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[28]:
</pre></div>
</div>
<div class="output_area docutils container">
<img alt="../../_images/tutorials_circuits_advanced_4_transpiler_passes_and_passmanager_49_0.png" src="../../_images/tutorials_circuits_advanced_4_transpiler_passes_and_passmanager_49_0.png" />
</div>
</div>
<p>このパスはデバイスのカップリングマップに適合するように、全ての２量子ビットの相互作用が出来るように swap を追加しているだけであるという点に着目してください。このパスは相互作用の方向やデバイスがサポートするネイティブゲートについては考慮していません。これは Qiskitのトランスパイラーの設計思想です。全てのパスは小さく、よく定義されたアクションを持ち、積極的な回路の最適化は複数のパスを組み合わせるパスマネージャーによって達成されます。</p>
</div>
<div class="section" id="トランスパイラーロギング">
<h2>トランスパイラーロギング<a class="headerlink" href="#トランスパイラーロギング" title="このヘッドラインへのパーマリンク">¶</a></h2>
<p>トランスパイラーが実装する内部操作の複雑性のため、問題をデバッグしたり呼び出した時にトランスバイラー内部で何が行われているかを理解したい局面が発生するでしょう。これを達成するために、通常の操作の一部としてトランスパイラーはログメッセージを出力します。ロギングには、Python の標準ライブラリの <code class="docutils literal notranslate"><span class="pre">logging</span></code> モジュールを利用してログメッセージを出しています。Python の標準ロギングを使用しているので、Qiskit-Terra のロギングを他のアプリケーションやライブラリと組みわせることが出来るようになります。</p>
<p>Python のロギングについての情報は、 <a class="reference external" href="https://docs.python.org/3/library/logging.html">公式ドキュメント</a> 、及びリンク先のチュートリアルと cookbook を参照してください。</p>
<div class="alert alert-block alert-success"><div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;</span><span class="n">b</span><span class="o">&gt;</span><span class="n">Note</span><span class="p">:</span><span class="o">&lt;/</span><span class="n">b</span><span class="o">&gt;</span> <span class="n">Most</span> <span class="n">of</span> <span class="n">the</span> <span class="o">&lt;</span><span class="n">code</span><span class="o">&gt;</span><span class="n">logging</span><span class="o">&lt;/</span><span class="n">code</span><span class="o">&gt;</span> <span class="n">module</span> <span class="n">functions</span> <span class="n">used</span> <span class="ow">in</span> <span class="n">this</span> <span class="n">section</span> <span class="n">adjust</span> <span class="k">global</span> <span class="n">settings</span><span class="o">.</span> <span class="n">If</span> <span class="n">you</span> <span class="n">run</span> <span class="n">commands</span> <span class="ow">in</span> <span class="n">this</span> <span class="n">section</span> <span class="n">it</span> <span class="n">might</span> <span class="n">effect</span> <span class="n">the</span> <span class="n">output</span> <span class="kn">from</span> <span class="nn">other</span> <span class="n">cells</span> <span class="k">if</span> <span class="n">they</span> <span class="n">are</span> <span class="n">run</span> <span class="ow">in</span> <span class="n">a</span> <span class="n">different</span> <span class="n">order</span><span class="o">.</span>
</pre></div>
</div>
</div><div class="section" id="Python-ロギング標準ライブラリの設定">
<h3>Python ロギング標準ライブラリの設定<a class="headerlink" href="#Python-ロギング標準ライブラリの設定" title="このヘッドラインへのパーマリンク">¶</a></h3>
<p>デフォルトでは Python 標準ロギングは、 <code class="docutils literal notranslate"><span class="pre">WARNING</span></code> 、 <code class="docutils literal notranslate"><span class="pre">ERROR</span></code> 、 <code class="docutils literal notranslate"><span class="pre">CRITICAL</span></code> ログレベルでのみログメッセージを出力します。トランスパイラーではこれらのログレベルを利用しておらず(全ては情報のみ) ログを吐きませんので、ロギングを設定する必要があります。</p>
<p>最も簡単な方法は次を実行することです:</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[29]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="kn">import</span> <span class="nn">logging</span>

<span class="n">logging</span><span class="o">.</span><span class="n">basicConfig</span><span class="p">(</span><span class="n">level</span><span class="o">=</span><span class="s1">&#39;DEBUG&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">basicConfig()</span></code> 関数 (ドキュメントは以下を参照してください: <a class="reference external" href="https://docs.python.org/3/library/logging.html#logging.basicConfig">https://docs.python.org/3/library/logging.html#logging.basicConfig</a>) ルートハンドラーとフォーマッタを設定します。ここでは <a class="reference external" href="https://docs.python.org/3/library/logging.html#levels">ログレベル</a> を <code class="docutils literal notranslate"><span class="pre">level</span></code> kwarg で設定しています。特例のレベルに設定するとより高位のレベルも含まれます。例えば、 <code class="docutils literal notranslate"><span class="pre">INFO</span></code> に設定すると、 <code class="docutils literal notranslate"><span class="pre">INFO</span></code> レベルだけではなく、 <code class="docutils literal notranslate"><span class="pre">WARNING</span></code> 、 <code class="docutils literal notranslate"><span class="pre">ERROR</span></code> 、 及び <code class="docutils literal notranslate"><span class="pre">CRITICAL</span></code> ログレベルも含まれます。</p>
<p>このノートブックの Python 環境ではトランスパイラーを実行した時に stderr にログメッセージを出力するように設定されています。例えば：</p>
<div class="alert alert-block alert-success"><div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;</span><span class="n">b</span><span class="o">&gt;</span><span class="n">Note</span><span class="p">:</span><span class="o">&lt;/</span><span class="n">b</span><span class="o">&gt;</span> <span class="o">&lt;</span><span class="n">code</span><span class="o">&gt;</span><span class="n">basicConfig</span><span class="p">()</span><span class="o">&lt;/</span><span class="n">code</span><span class="o">&gt;</span> <span class="n">will</span> <span class="n">only</span> <span class="n">work</span> <span class="n">when</span> <span class="n">called</span> <span class="n">the</span> <span class="n">first</span> <span class="n">time</span> <span class="n">it</span><span class="s1">&#39;s called. It detects if a root handler and formatter have already been setup (either by using an earlier &lt;code&gt;basicConfig()&lt;/code&gt; call or otherwise) and does nothing if they have. Further adjustments will have to by interacting with the handler directly.</span>
</pre></div>
</div>
</div><div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[30]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="kn">from</span> <span class="nn">qiskit.test.mock</span> <span class="kn">import</span> <span class="n">FakeTenerife</span>


<span class="n">log_circ</span> <span class="o">=</span> <span class="n">QuantumCircuit</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
<span class="n">log_circ</span><span class="o">.</span><span class="n">h</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
<span class="n">log_circ</span><span class="o">.</span><span class="n">h</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<span class="n">log_circ</span><span class="o">.</span><span class="n">h</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<span class="n">log_circ</span><span class="o">.</span><span class="n">x</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<span class="n">log_circ</span><span class="o">.</span><span class="n">cx</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">log_circ</span><span class="o">.</span><span class="n">measure</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">])</span>

<span class="n">backend</span> <span class="o">=</span> <span class="n">FakeTenerife</span><span class="p">()</span>

<span class="n">transpile</span><span class="p">(</span><span class="n">log_circ</span><span class="p">,</span> <span class="n">backend</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
INFO:qiskit.transpiler.runningpassmanager:Pass: SetLayout - 0.00572 (ms)
INFO:qiskit.transpiler.runningpassmanager:Pass: TrivialLayout - 0.05198 (ms)
INFO:qiskit.transpiler.runningpassmanager:Pass: Layout2qDistance - 1.66774 (ms)
INFO:qiskit.transpiler.runningpassmanager:Pass: FullAncillaAllocation - 0.49877 (ms)
INFO:qiskit.transpiler.runningpassmanager:Pass: EnlargeWithAncilla - 0.07701 (ms)
INFO:qiskit.transpiler.runningpassmanager:Pass: ApplyLayout - 4.66800 (ms)
INFO:qiskit.transpiler.runningpassmanager:Pass: Unroll3qOrMore - 0.03099 (ms)
INFO:qiskit.transpiler.runningpassmanager:Pass: CheckMap - 0.78487 (ms)
INFO:qiskit.transpiler.runningpassmanager:Pass: UnrollCustomDefinitions - 0.13685 (ms)
INFO:qiskit.transpiler.passes.basis.basis_translator:Begin BasisTranslator from source basis {(&#39;measure&#39;, 1), (&#39;x&#39;, 1), (&#39;cx&#39;, 2), (&#39;h&#39;, 1)} to target basis {&#39;u1&#39;, &#39;measure&#39;, &#39;reset&#39;, &#39;u2&#39;, &#39;u3&#39;, &#39;id&#39;, &#39;barrier&#39;, &#39;cx&#39;, &#39;snapshot&#39;}.
DEBUG:qiskit.transpiler.passes.basis.basis_translator:Begining basis search from frozenset({(&#39;measure&#39;, 1), (&#39;x&#39;, 1), (&#39;cx&#39;, 2), (&#39;h&#39;, 1)}) to frozenset({&#39;u2&#39;, &#39;u3&#39;, &#39;id&#39;, &#39;u1&#39;, &#39;measure&#39;, &#39;barrier&#39;, &#39;reset&#39;, &#39;cx&#39;, &#39;snapshot&#39;}).
DEBUG:qiskit.transpiler.passes.basis.basis_translator:Inspecting basis frozenset({(&#39;measure&#39;, 1), (&#39;x&#39;, 1), (&#39;cx&#39;, 2), (&#39;h&#39;, 1)}).
DEBUG:qiskit.transpiler.passes.basis.basis_translator:Inspecting basis frozenset({(&#39;measure&#39;, 1), (&#39;u3&#39;, 1), (&#39;cx&#39;, 2), (&#39;h&#39;, 1)}).
DEBUG:qiskit.transpiler.passes.basis.basis_translator:Transformation path:
DEBUG:qiskit.transpiler.passes.basis.basis_translator:x/1 =&gt; []
     ┌─────────────┐
q_0: ┤ U3(pi,0,pi) ├
     └─────────────┘
DEBUG:qiskit.transpiler.passes.basis.basis_translator:h/1 =&gt; []
     ┌──────────┐
q_0: ┤ U2(0,pi) ├
     └──────────┘
INFO:qiskit.transpiler.passes.basis.basis_translator:Basis translation path search completed in 0.018s.
DEBUG:qiskit.transpiler.passes.basis.basis_translator:Composing transform step: x/1 [] =&gt;
     ┌─────────────┐
q_0: ┤ U3(pi,0,pi) ├
     └─────────────┘
DEBUG:qiskit.transpiler.passes.basis.basis_translator:Updating transform for mapped instr (&#39;x&#39;, 1) x, [] from
        ┌───┐
q293_0: ┤ x ├
        └───┘
DEBUG:qiskit.transpiler.passes.basis.basis_translator:Updated transform for mapped instr (&#39;x&#39;, 1) x, [] to
        ┌─────────────┐
q293_0: ┤ U3(pi,0,pi) ├
        └─────────────┘
DEBUG:qiskit.transpiler.passes.basis.basis_translator:Composing transform step: h/1 [] =&gt;
     ┌──────────┐
q_0: ┤ U2(0,pi) ├
     └──────────┘
DEBUG:qiskit.transpiler.passes.basis.basis_translator:Updating transform for mapped instr (&#39;h&#39;, 1) h, [] from
        ┌───┐
q295_0: ┤ h ├
        └───┘
DEBUG:qiskit.transpiler.passes.basis.basis_translator:Updated transform for mapped instr (&#39;h&#39;, 1) h, [] to
        ┌──────────┐
q295_0: ┤ U2(0,pi) ├
        └──────────┘
INFO:qiskit.transpiler.passes.basis.basis_translator:Basis translation paths composed in 0.025s.
INFO:qiskit.transpiler.passes.basis.basis_translator:Basis translation instructions replaced in 0.000s.
INFO:qiskit.transpiler.runningpassmanager:Pass: BasisTranslator - 54.64506 (ms)
INFO:qiskit.transpiler.runningpassmanager:Pass: CheckCXDirection - 0.10204 (ms)
INFO:qiskit.transpiler.runningpassmanager:Pass: CXDirection - 1.06287 (ms)
INFO:qiskit.transpiler.runningpassmanager:Pass: RemoveResetInZeroState - 0.05889 (ms)
INFO:qiskit.transpiler.runningpassmanager:Pass: Depth - 0.05293 (ms)
INFO:qiskit.transpiler.runningpassmanager:Pass: FixedPoint - 0.02575 (ms)
INFO:qiskit.transpiler.runningpassmanager:Pass: Optimize1qGates - 7.69925 (ms)
INFO:qiskit.transpiler.runningpassmanager:Pass: CXCancellation - 0.07701 (ms)
INFO:qiskit.transpiler.runningpassmanager:Pass: Depth - 0.04292 (ms)
INFO:qiskit.transpiler.runningpassmanager:Pass: FixedPoint - 0.03409 (ms)
INFO:qiskit.transpiler.runningpassmanager:Pass: Optimize1qGates - 0.25916 (ms)
INFO:qiskit.transpiler.runningpassmanager:Pass: CXCancellation - 0.07796 (ms)
INFO:qiskit.transpiler.runningpassmanager:Pass: Depth - 0.04506 (ms)
INFO:qiskit.transpiler.runningpassmanager:Pass: FixedPoint - 0.02670 (ms)
INFO:qiskit.transpiler.runningpassmanager:Pass: Optimize1qGates - 0.57507 (ms)
INFO:qiskit.transpiler.runningpassmanager:Pass: CXCancellation - 0.06580 (ms)
INFO:qiskit.compiler.transpile:Total Transpile Time - 148.27323 (ms)
</pre></div></div>
</div>
<p>ここではっきりわかるように、<code class="docutils literal notranslate"><span class="pre">transpile()</span></code> を呼び出すと2種類のログメッセージを出力されるようになりました。1つ目は <code class="docutils literal notranslate"><span class="pre">INFO</span></code> ログレベルで、パスマネージャーからのものです。これらは、実行された各パスとその所要時間を示しています。2番目は <code class="docutils literal notranslate"><span class="pre">DEBUG</span></code> レベルであり、StochasticSwapパスからのもので、そのパスの内部操作を記述しています。パスの操作における問題をデバッグするのに役立ちます。</p>
</div>
<div class="section" id="トランスパイラーのログレベルを調整する">
<h3>トランスパイラーのログレベルを調整する<a class="headerlink" href="#トランスパイラーのログレベルを調整する" title="このヘッドラインへのパーマリンク">¶</a></h3>
<p>Qiskit トランスパイラーは、 <code class="docutils literal notranslate"><span class="pre">logging.getLogger('qiskit.transpiler')</span></code> で利用されているように、 単一のネームスペース <code class="docutils literal notranslate"><span class="pre">qiskit.transpiler</span></code> を利用しています。これによりトランスパイラー単独のログレベルを調整することが簡単に出来ます。例えば、INFO レベル以上のログメッセージだけを確認したい場合は、次のように実行できます：</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[31]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="s1">&#39;qiskit.transpiler&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">setLevel</span><span class="p">(</span><span class="s1">&#39;INFO&#39;</span><span class="p">)</span>
<span class="n">transpile</span><span class="p">(</span><span class="n">log_circ</span><span class="p">,</span> <span class="n">backend</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
INFO:qiskit.transpiler.runningpassmanager:Pass: SetLayout - 0.00620 (ms)
INFO:qiskit.transpiler.runningpassmanager:Pass: TrivialLayout - 0.05102 (ms)
INFO:qiskit.transpiler.runningpassmanager:Pass: Layout2qDistance - 0.42892 (ms)
INFO:qiskit.transpiler.runningpassmanager:Pass: FullAncillaAllocation - 4.39119 (ms)
INFO:qiskit.transpiler.runningpassmanager:Pass: EnlargeWithAncilla - 0.07820 (ms)
INFO:qiskit.transpiler.runningpassmanager:Pass: ApplyLayout - 0.37098 (ms)
INFO:qiskit.transpiler.runningpassmanager:Pass: Unroll3qOrMore - 0.02718 (ms)
INFO:qiskit.transpiler.runningpassmanager:Pass: CheckMap - 0.07915 (ms)
INFO:qiskit.transpiler.runningpassmanager:Pass: UnrollCustomDefinitions - 0.09871 (ms)
INFO:qiskit.transpiler.passes.basis.basis_translator:Begin BasisTranslator from source basis {(&#39;measure&#39;, 1), (&#39;x&#39;, 1), (&#39;cx&#39;, 2), (&#39;h&#39;, 1)} to target basis {&#39;u1&#39;, &#39;measure&#39;, &#39;reset&#39;, &#39;u2&#39;, &#39;u3&#39;, &#39;id&#39;, &#39;barrier&#39;, &#39;cx&#39;, &#39;snapshot&#39;}.
INFO:qiskit.transpiler.passes.basis.basis_translator:Basis translation path search completed in 0.000s.
INFO:qiskit.transpiler.passes.basis.basis_translator:Basis translation paths composed in 0.005s.
INFO:qiskit.transpiler.passes.basis.basis_translator:Basis translation instructions replaced in 0.000s.
INFO:qiskit.transpiler.runningpassmanager:Pass: BasisTranslator - 18.19015 (ms)
INFO:qiskit.transpiler.runningpassmanager:Pass: CheckCXDirection - 0.05913 (ms)
INFO:qiskit.transpiler.runningpassmanager:Pass: CXDirection - 0.55003 (ms)
INFO:qiskit.transpiler.runningpassmanager:Pass: RemoveResetInZeroState - 0.02885 (ms)
INFO:qiskit.transpiler.runningpassmanager:Pass: Depth - 0.03982 (ms)
INFO:qiskit.transpiler.runningpassmanager:Pass: FixedPoint - 0.01907 (ms)
INFO:qiskit.transpiler.runningpassmanager:Pass: Optimize1qGates - 1.39475 (ms)
INFO:qiskit.transpiler.runningpassmanager:Pass: CXCancellation - 0.07081 (ms)
INFO:qiskit.transpiler.runningpassmanager:Pass: Depth - 0.04077 (ms)
INFO:qiskit.transpiler.runningpassmanager:Pass: FixedPoint - 0.02885 (ms)
INFO:qiskit.transpiler.runningpassmanager:Pass: Optimize1qGates - 0.19217 (ms)
INFO:qiskit.transpiler.runningpassmanager:Pass: CXCancellation - 0.09584 (ms)
INFO:qiskit.transpiler.runningpassmanager:Pass: Depth - 0.04411 (ms)
INFO:qiskit.transpiler.runningpassmanager:Pass: FixedPoint - 0.05698 (ms)
INFO:qiskit.transpiler.runningpassmanager:Pass: Optimize1qGates - 0.33522 (ms)
INFO:qiskit.transpiler.runningpassmanager:Pass: CXCancellation - 0.08488 (ms)
INFO:qiskit.compiler.transpile:Total Transpile Time - 114.33411 (ms)
</pre></div></div>
</div>
</div>
<div class="section" id="平行実行を扱うためのログ設定">
<h3>平行実行を扱うためのログ設定<a class="headerlink" href="#平行実行を扱うためのログ設定" title="このヘッドラインへのパーマリンク">¶</a></h3>
<p>複数の回路をトランスパイルする時にはデフォルトではこれらの回路は平行でトランスパイルされます。ログレベルを設定してこれを実行し、出力を理解できるようにするには追加のステップが必要です。</p>
<p>単にロギングを設定して 複数の回路に対して <code class="docutils literal notranslate"><span class="pre">transpile()</span></code> を渡しただけでは、解読が難しい結果になるでしょう。例えば：</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[32]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># Change log level back to DEBUG</span>
<span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="s1">&#39;qiskit.transpiler&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">setLevel</span><span class="p">(</span><span class="s1">&#39;DEBUG&#39;</span><span class="p">)</span>
<span class="c1"># Transpile multiple circuits</span>
<span class="n">circuits</span> <span class="o">=</span> <span class="p">[</span><span class="n">log_circ</span><span class="p">,</span> <span class="n">log_circ</span><span class="p">]</span>
<span class="n">transpile</span><span class="p">(</span><span class="n">circuits</span><span class="p">,</span> <span class="n">backend</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
INFO:qiskit.transpiler.runningpassmanager:Pass: SetLayout - 0.01097 (ms)
INFO:qiskit.transpiler.runningpassmanager:Pass: SetLayout - 0.01097 (ms)
INFO:qiskit.transpiler.runningpassmanager:Pass: TrivialLayout - 0.20790 (ms)
INFO:qiskit.transpiler.runningpassmanager:Pass: TrivialLayout - 0.20885 (ms)
INFO:qiskit.transpiler.runningpassmanager:Pass: Layout2qDistance - 1.32680 (ms)
INFO:qiskit.transpiler.runningpassmanager:Pass: Layout2qDistance - 1.40786 (ms)
INFO:qiskit.transpiler.runningpassmanager:Pass: FullAncillaAllocation - 0.34833 (ms)
INFO:qiskit.transpiler.runningpassmanager:Pass: FullAncillaAllocation - 0.33307 (ms)
INFO:qiskit.transpiler.runningpassmanager:Pass: EnlargeWithAncilla - 0.18096 (ms)
INFO:qiskit.transpiler.runningpassmanager:Pass: EnlargeWithAncilla - 0.20790 (ms)
INFO:qiskit.transpiler.runningpassmanager:Pass: ApplyLayout - 0.54884 (ms)
INFO:qiskit.transpiler.runningpassmanager:Pass: ApplyLayout - 0.94795 (ms)
INFO:qiskit.transpiler.runningpassmanager:Pass: Unroll3qOrMore - 0.05293 (ms)
INFO:qiskit.transpiler.runningpassmanager:Pass: Unroll3qOrMore - 0.09179 (ms)
INFO:qiskit.transpiler.runningpassmanager:Pass: CheckMap - 0.10514 (ms)
INFO:qiskit.transpiler.runningpassmanager:Pass: CheckMap - 0.10204 (ms)
INFO:qiskit.transpiler.runningpassmanager:Pass: UnrollCustomDefinitions - 0.27966 (ms)
INFO:qiskit.transpiler.runningpassmanager:Pass: UnrollCustomDefinitions - 0.23818 (ms)
INFO:qiskit.transpiler.passes.basis.basis_translator:Begin BasisTranslator from source basis {(&#39;measure&#39;, 1), (&#39;x&#39;, 1), (&#39;cx&#39;, 2), (&#39;h&#39;, 1)} to target basis {&#39;u1&#39;, &#39;measure&#39;, &#39;reset&#39;, &#39;u2&#39;, &#39;u3&#39;, &#39;id&#39;, &#39;barrier&#39;, &#39;cx&#39;, &#39;snapshot&#39;}.
DEBUG:qiskit.transpiler.passes.basis.basis_translator:Begining basis search from frozenset({(&#39;measure&#39;, 1), (&#39;x&#39;, 1), (&#39;cx&#39;, 2), (&#39;h&#39;, 1)}) to frozenset({&#39;u2&#39;, &#39;u3&#39;, &#39;id&#39;, &#39;u1&#39;, &#39;measure&#39;, &#39;barrier&#39;, &#39;reset&#39;, &#39;cx&#39;, &#39;snapshot&#39;}).
INFO:qiskit.transpiler.passes.basis.basis_translator:Begin BasisTranslator from source basis {(&#39;measure&#39;, 1), (&#39;x&#39;, 1), (&#39;cx&#39;, 2), (&#39;h&#39;, 1)} to target basis {&#39;u1&#39;, &#39;measure&#39;, &#39;reset&#39;, &#39;u2&#39;, &#39;u3&#39;, &#39;id&#39;, &#39;barrier&#39;, &#39;cx&#39;, &#39;snapshot&#39;}.
DEBUG:qiskit.transpiler.passes.basis.basis_translator:Inspecting basis frozenset({(&#39;measure&#39;, 1), (&#39;x&#39;, 1), (&#39;cx&#39;, 2), (&#39;h&#39;, 1)}).
DEBUG:qiskit.transpiler.passes.basis.basis_translator:Begining basis search from frozenset({(&#39;measure&#39;, 1), (&#39;x&#39;, 1), (&#39;cx&#39;, 2), (&#39;h&#39;, 1)}) to frozenset({&#39;u2&#39;, &#39;u3&#39;, &#39;id&#39;, &#39;u1&#39;, &#39;measure&#39;, &#39;barrier&#39;, &#39;reset&#39;, &#39;cx&#39;, &#39;snapshot&#39;}).
DEBUG:qiskit.transpiler.passes.basis.basis_translator:Inspecting basis frozenset({(&#39;measure&#39;, 1), (&#39;u3&#39;, 1), (&#39;cx&#39;, 2), (&#39;h&#39;, 1)}).
DEBUG:qiskit.transpiler.passes.basis.basis_translator:Inspecting basis frozenset({(&#39;measure&#39;, 1), (&#39;x&#39;, 1), (&#39;cx&#39;, 2), (&#39;h&#39;, 1)}).
DEBUG:qiskit.transpiler.passes.basis.basis_translator:Transformation path:
DEBUG:qiskit.transpiler.passes.basis.basis_translator:Inspecting basis frozenset({(&#39;measure&#39;, 1), (&#39;u3&#39;, 1), (&#39;cx&#39;, 2), (&#39;h&#39;, 1)}).
DEBUG:qiskit.transpiler.passes.basis.basis_translator:x/1 =&gt; []
     ┌─────────────┐
q_0: ┤ U3(pi,0,pi) ├
     └─────────────┘
DEBUG:qiskit.transpiler.passes.basis.basis_translator:Transformation path:
DEBUG:qiskit.transpiler.passes.basis.basis_translator:h/1 =&gt; []
     ┌──────────┐
q_0: ┤ U2(0,pi) ├
     └──────────┘
INFO:qiskit.transpiler.passes.basis.basis_translator:Basis translation path search completed in 0.022s.
DEBUG:qiskit.transpiler.passes.basis.basis_translator:x/1 =&gt; []
     ┌─────────────┐
q_0: ┤ U3(pi,0,pi) ├
     └─────────────┘
DEBUG:qiskit.transpiler.passes.basis.basis_translator:Composing transform step: x/1 [] =&gt;
     ┌─────────────┐
q_0: ┤ U3(pi,0,pi) ├
     └─────────────┘
DEBUG:qiskit.transpiler.passes.basis.basis_translator:h/1 =&gt; []
     ┌──────────┐
q_0: ┤ U2(0,pi) ├
     └──────────┘
DEBUG:qiskit.transpiler.passes.basis.basis_translator:Updating transform for mapped instr (&#39;x&#39;, 1) x, [] from
        ┌───┐
q303_0: ┤ x ├
        └───┘
INFO:qiskit.transpiler.passes.basis.basis_translator:Basis translation path search completed in 0.030s.
DEBUG:qiskit.transpiler.passes.basis.basis_translator:Updated transform for mapped instr (&#39;x&#39;, 1) x, [] to
        ┌─────────────┐
q303_0: ┤ U3(pi,0,pi) ├
        └─────────────┘
DEBUG:qiskit.transpiler.passes.basis.basis_translator:Composing transform step: x/1 [] =&gt;
     ┌─────────────┐
q_0: ┤ U3(pi,0,pi) ├
     └─────────────┘
DEBUG:qiskit.transpiler.passes.basis.basis_translator:Composing transform step: h/1 [] =&gt;
     ┌──────────┐
q_0: ┤ U2(0,pi) ├
     └──────────┘
DEBUG:qiskit.transpiler.passes.basis.basis_translator:Updating transform for mapped instr (&#39;h&#39;, 1) h, [] from
        ┌───┐
q305_0: ┤ h ├
        └───┘
DEBUG:qiskit.transpiler.passes.basis.basis_translator:Updating transform for mapped instr (&#39;x&#39;, 1) x, [] from
        ┌───┐
q303_0: ┤ x ├
        └───┘
DEBUG:qiskit.transpiler.passes.basis.basis_translator:Updated transform for mapped instr (&#39;h&#39;, 1) h, [] to
        ┌──────────┐
q305_0: ┤ U2(0,pi) ├
        └──────────┘
INFO:qiskit.transpiler.passes.basis.basis_translator:Basis translation paths composed in 0.028s.
DEBUG:qiskit.transpiler.passes.basis.basis_translator:Updated transform for mapped instr (&#39;x&#39;, 1) x, [] to
        ┌─────────────┐
q303_0: ┤ U3(pi,0,pi) ├
        └─────────────┘
DEBUG:qiskit.transpiler.passes.basis.basis_translator:Composing transform step: h/1 [] =&gt;
     ┌──────────┐
q_0: ┤ U2(0,pi) ├
     └──────────┘
DEBUG:qiskit.transpiler.passes.basis.basis_translator:Updating transform for mapped instr (&#39;h&#39;, 1) h, [] from
        ┌───┐
q305_0: ┤ h ├
        └───┘
DEBUG:qiskit.transpiler.passes.basis.basis_translator:Updated transform for mapped instr (&#39;h&#39;, 1) h, [] to
        ┌──────────┐
q305_0: ┤ U2(0,pi) ├
        └──────────┘
INFO:qiskit.transpiler.passes.basis.basis_translator:Basis translation paths composed in 0.034s.
INFO:qiskit.transpiler.passes.basis.basis_translator:Basis translation instructions replaced in 0.000s.
INFO:qiskit.transpiler.passes.basis.basis_translator:Basis translation instructions replaced in 0.000s.
INFO:qiskit.transpiler.runningpassmanager:Pass: BasisTranslator - 77.34990 (ms)
INFO:qiskit.transpiler.runningpassmanager:Pass: CheckCXDirection - 0.09203 (ms)
INFO:qiskit.transpiler.runningpassmanager:Pass: BasisTranslator - 77.99387 (ms)
INFO:qiskit.transpiler.runningpassmanager:Pass: CheckCXDirection - 0.15020 (ms)
INFO:qiskit.transpiler.runningpassmanager:Pass: CXDirection - 1.56689 (ms)
INFO:qiskit.transpiler.runningpassmanager:Pass: RemoveResetInZeroState - 0.04792 (ms)
INFO:qiskit.transpiler.runningpassmanager:Pass: CXDirection - 1.92308 (ms)
INFO:qiskit.transpiler.runningpassmanager:Pass: Depth - 0.19288 (ms)
INFO:qiskit.transpiler.runningpassmanager:Pass: RemoveResetInZeroState - 0.07296 (ms)
INFO:qiskit.transpiler.runningpassmanager:Pass: FixedPoint - 0.06080 (ms)
INFO:qiskit.transpiler.runningpassmanager:Pass: Depth - 0.13185 (ms)
INFO:qiskit.transpiler.runningpassmanager:Pass: FixedPoint - 0.07296 (ms)
INFO:qiskit.transpiler.runningpassmanager:Pass: Optimize1qGates - 2.87366 (ms)
INFO:qiskit.transpiler.runningpassmanager:Pass: CXCancellation - 0.14591 (ms)
INFO:qiskit.transpiler.runningpassmanager:Pass: Optimize1qGates - 3.46994 (ms)
INFO:qiskit.transpiler.runningpassmanager:Pass: Depth - 0.06485 (ms)
INFO:qiskit.transpiler.runningpassmanager:Pass: CXCancellation - 0.21386 (ms)
INFO:qiskit.transpiler.runningpassmanager:Pass: FixedPoint - 0.03386 (ms)
INFO:qiskit.transpiler.runningpassmanager:Pass: Depth - 0.10610 (ms)
INFO:qiskit.transpiler.runningpassmanager:Pass: Optimize1qGates - 0.35787 (ms)
INFO:qiskit.transpiler.runningpassmanager:Pass: CXCancellation - 0.09322 (ms)
INFO:qiskit.transpiler.runningpassmanager:Pass: Depth - 0.05221 (ms)
INFO:qiskit.transpiler.runningpassmanager:Pass: FixedPoint - 0.03099 (ms)
INFO:qiskit.transpiler.runningpassmanager:Pass: FixedPoint - 0.03815 (ms)
INFO:qiskit.transpiler.runningpassmanager:Pass: Optimize1qGates - 2.49076 (ms)
INFO:qiskit.transpiler.runningpassmanager:Pass: Optimize1qGates - 0.33498 (ms)
INFO:qiskit.transpiler.runningpassmanager:Pass: CXCancellation - 0.10800 (ms)
INFO:qiskit.transpiler.runningpassmanager:Pass: CXCancellation - 0.10586 (ms)
INFO:qiskit.transpiler.runningpassmanager:Pass: Depth - 1.18303 (ms)
INFO:qiskit.transpiler.runningpassmanager:Pass: FixedPoint - 0.01907 (ms)
INFO:qiskit.transpiler.runningpassmanager:Pass: Optimize1qGates - 0.18406 (ms)
INFO:qiskit.transpiler.runningpassmanager:Pass: CXCancellation - 0.21291 (ms)
INFO:qiskit.compiler.transpile:Total Transpile Time - 251.47891 (ms)
</pre></div></div>
</div>
<p>結果から確認出来るように３つの回路が一緒にトランスパイルされているログメッセージを取得しています。どのパスがどの回路のトランスパイルの一部なのかを知る手段がありません。幸いなことに、Python ロギングではこの状況を扱う手段を提供しています。簡単な方法は、<a class="reference external" href="https://docs.python.org/3/library/logging.html#logging.Formatter">ログフォーマッタ</a> を変更して追加情報を含めるようにし、どのプロセスからログメッセージが出ているかを関連づけることです。</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[33]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">formatter</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">Formatter</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%(name)s</span><span class="s1"> - </span><span class="si">%(processName)-10s</span><span class="s1"> - </span><span class="si">%(levelname)s</span><span class="s1">: </span><span class="si">%(message)s</span><span class="s1">&#39;</span><span class="p">)</span>
<span class="n">handler</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">()</span><span class="o">.</span><span class="n">handlers</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="n">handler</span><span class="o">.</span><span class="n">setFormatter</span><span class="p">(</span><span class="n">formatter</span><span class="p">)</span>
</pre></div>
</div>
</div>
<p>次に、 <code class="docutils literal notranslate"><span class="pre">transpile()</span></code> 呼び出しを再実行し新しいログフォーマッタを確認します。</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[34]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">transpile</span><span class="p">(</span><span class="n">circuits</span><span class="p">,</span> <span class="n">backend</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
qiskit.transpiler.runningpassmanager - ForkProcess-3 - INFO: Pass: SetLayout - 0.01907 (ms)
qiskit.transpiler.runningpassmanager - ForkProcess-3 - INFO: Pass: TrivialLayout - 0.22817 (ms)
qiskit.transpiler.runningpassmanager - ForkProcess-3 - INFO: Pass: Layout2qDistance - 1.35589 (ms)
qiskit.transpiler.runningpassmanager - ForkProcess-4 - INFO: Pass: SetLayout - 0.01979 (ms)
qiskit.transpiler.runningpassmanager - ForkProcess-3 - INFO: Pass: FullAncillaAllocation - 0.28706 (ms)
qiskit.transpiler.runningpassmanager - ForkProcess-4 - INFO: Pass: TrivialLayout - 0.19479 (ms)
qiskit.transpiler.runningpassmanager - ForkProcess-3 - INFO: Pass: EnlargeWithAncilla - 0.17881 (ms)
qiskit.transpiler.runningpassmanager - ForkProcess-4 - INFO: Pass: Layout2qDistance - 1.45626 (ms)
qiskit.transpiler.runningpassmanager - ForkProcess-3 - INFO: Pass: ApplyLayout - 0.95296 (ms)
qiskit.transpiler.runningpassmanager - ForkProcess-4 - INFO: Pass: FullAncillaAllocation - 0.38600 (ms)
qiskit.transpiler.runningpassmanager - ForkProcess-3 - INFO: Pass: Unroll3qOrMore - 0.05603 (ms)
qiskit.transpiler.runningpassmanager - ForkProcess-4 - INFO: Pass: EnlargeWithAncilla - 0.20623 (ms)
qiskit.transpiler.runningpassmanager - ForkProcess-3 - INFO: Pass: CheckMap - 0.08702 (ms)
qiskit.transpiler.runningpassmanager - ForkProcess-4 - INFO: Pass: ApplyLayout - 0.83709 (ms)
qiskit.transpiler.runningpassmanager - ForkProcess-3 - INFO: Pass: UnrollCustomDefinitions - 0.30303 (ms)
qiskit.transpiler.runningpassmanager - ForkProcess-4 - INFO: Pass: Unroll3qOrMore - 0.06509 (ms)
qiskit.transpiler.runningpassmanager - ForkProcess-4 - INFO: Pass: CheckMap - 0.07677 (ms)
qiskit.transpiler.passes.basis.basis_translator - ForkProcess-3 - INFO: Begin BasisTranslator from source basis {(&#39;measure&#39;, 1), (&#39;x&#39;, 1), (&#39;cx&#39;, 2), (&#39;h&#39;, 1)} to target basis {&#39;u1&#39;, &#39;measure&#39;, &#39;reset&#39;, &#39;u2&#39;, &#39;u3&#39;, &#39;id&#39;, &#39;barrier&#39;, &#39;cx&#39;, &#39;snapshot&#39;}.
qiskit.transpiler.runningpassmanager - ForkProcess-4 - INFO: Pass: UnrollCustomDefinitions - 0.25010 (ms)
qiskit.transpiler.passes.basis.basis_translator - ForkProcess-3 - DEBUG: Begining basis search from frozenset({(&#39;measure&#39;, 1), (&#39;x&#39;, 1), (&#39;cx&#39;, 2), (&#39;h&#39;, 1)}) to frozenset({&#39;u2&#39;, &#39;u3&#39;, &#39;id&#39;, &#39;u1&#39;, &#39;measure&#39;, &#39;barrier&#39;, &#39;reset&#39;, &#39;cx&#39;, &#39;snapshot&#39;}).
qiskit.transpiler.passes.basis.basis_translator - ForkProcess-4 - INFO: Begin BasisTranslator from source basis {(&#39;measure&#39;, 1), (&#39;x&#39;, 1), (&#39;cx&#39;, 2), (&#39;h&#39;, 1)} to target basis {&#39;u1&#39;, &#39;measure&#39;, &#39;reset&#39;, &#39;u2&#39;, &#39;u3&#39;, &#39;id&#39;, &#39;barrier&#39;, &#39;cx&#39;, &#39;snapshot&#39;}.
qiskit.transpiler.passes.basis.basis_translator - ForkProcess-3 - DEBUG: Inspecting basis frozenset({(&#39;measure&#39;, 1), (&#39;x&#39;, 1), (&#39;cx&#39;, 2), (&#39;h&#39;, 1)}).
qiskit.transpiler.passes.basis.basis_translator - ForkProcess-4 - DEBUG: Begining basis search from frozenset({(&#39;measure&#39;, 1), (&#39;x&#39;, 1), (&#39;cx&#39;, 2), (&#39;h&#39;, 1)}) to frozenset({&#39;u2&#39;, &#39;u3&#39;, &#39;id&#39;, &#39;u1&#39;, &#39;measure&#39;, &#39;barrier&#39;, &#39;reset&#39;, &#39;cx&#39;, &#39;snapshot&#39;}).
qiskit.transpiler.passes.basis.basis_translator - ForkProcess-3 - DEBUG: Inspecting basis frozenset({(&#39;measure&#39;, 1), (&#39;u3&#39;, 1), (&#39;cx&#39;, 2), (&#39;h&#39;, 1)}).
qiskit.transpiler.passes.basis.basis_translator - ForkProcess-4 - DEBUG: Inspecting basis frozenset({(&#39;measure&#39;, 1), (&#39;x&#39;, 1), (&#39;cx&#39;, 2), (&#39;h&#39;, 1)}).
qiskit.transpiler.passes.basis.basis_translator - ForkProcess-3 - DEBUG: Transformation path:
qiskit.transpiler.passes.basis.basis_translator - ForkProcess-4 - DEBUG: Inspecting basis frozenset({(&#39;measure&#39;, 1), (&#39;u3&#39;, 1), (&#39;cx&#39;, 2), (&#39;h&#39;, 1)}).
qiskit.transpiler.passes.basis.basis_translator - ForkProcess-3 - DEBUG: x/1 =&gt; []
     ┌─────────────┐
q_0: ┤ U3(pi,0,pi) ├
     └─────────────┘
qiskit.transpiler.passes.basis.basis_translator - ForkProcess-4 - DEBUG: Transformation path:
qiskit.transpiler.passes.basis.basis_translator - ForkProcess-3 - DEBUG: h/1 =&gt; []
     ┌──────────┐
q_0: ┤ U2(0,pi) ├
     └──────────┘
qiskit.transpiler.passes.basis.basis_translator - ForkProcess-4 - DEBUG: x/1 =&gt; []
     ┌─────────────┐
q_0: ┤ U3(pi,0,pi) ├
     └─────────────┘
qiskit.transpiler.passes.basis.basis_translator - ForkProcess-3 - INFO: Basis translation path search completed in 0.025s.
qiskit.transpiler.passes.basis.basis_translator - ForkProcess-4 - DEBUG: h/1 =&gt; []
     ┌──────────┐
q_0: ┤ U2(0,pi) ├
     └──────────┘
qiskit.transpiler.passes.basis.basis_translator - ForkProcess-3 - DEBUG: Composing transform step: x/1 [] =&gt;
     ┌─────────────┐
q_0: ┤ U3(pi,0,pi) ├
     └─────────────┘
qiskit.transpiler.passes.basis.basis_translator - ForkProcess-4 - INFO: Basis translation path search completed in 0.025s.
qiskit.transpiler.passes.basis.basis_translator - ForkProcess-4 - DEBUG: Composing transform step: x/1 [] =&gt;
     ┌─────────────┐
q_0: ┤ U3(pi,0,pi) ├
     └─────────────┘
qiskit.transpiler.passes.basis.basis_translator - ForkProcess-3 - DEBUG: Updating transform for mapped instr (&#39;x&#39;, 1) x, [] from
        ┌───┐
q303_0: ┤ x ├
        └───┘
qiskit.transpiler.passes.basis.basis_translator - ForkProcess-4 - DEBUG: Updating transform for mapped instr (&#39;x&#39;, 1) x, [] from
        ┌───┐
q303_0: ┤ x ├
        └───┘
qiskit.transpiler.passes.basis.basis_translator - ForkProcess-3 - DEBUG: Updated transform for mapped instr (&#39;x&#39;, 1) x, [] to
        ┌─────────────┐
q303_0: ┤ U3(pi,0,pi) ├
        └─────────────┘
qiskit.transpiler.passes.basis.basis_translator - ForkProcess-3 - DEBUG: Composing transform step: h/1 [] =&gt;
     ┌──────────┐
q_0: ┤ U2(0,pi) ├
     └──────────┘
qiskit.transpiler.passes.basis.basis_translator - ForkProcess-4 - DEBUG: Updated transform for mapped instr (&#39;x&#39;, 1) x, [] to
        ┌─────────────┐
q303_0: ┤ U3(pi,0,pi) ├
        └─────────────┘
qiskit.transpiler.passes.basis.basis_translator - ForkProcess-4 - DEBUG: Composing transform step: h/1 [] =&gt;
     ┌──────────┐
q_0: ┤ U2(0,pi) ├
     └──────────┘
qiskit.transpiler.passes.basis.basis_translator - ForkProcess-3 - DEBUG: Updating transform for mapped instr (&#39;h&#39;, 1) h, [] from
        ┌───┐
q305_0: ┤ h ├
        └───┘
qiskit.transpiler.passes.basis.basis_translator - ForkProcess-4 - DEBUG: Updating transform for mapped instr (&#39;h&#39;, 1) h, [] from
        ┌───┐
q305_0: ┤ h ├
        └───┘
qiskit.transpiler.passes.basis.basis_translator - ForkProcess-3 - DEBUG: Updated transform for mapped instr (&#39;h&#39;, 1) h, [] to
        ┌──────────┐
q305_0: ┤ U2(0,pi) ├
        └──────────┘
qiskit.transpiler.passes.basis.basis_translator - ForkProcess-3 - INFO: Basis translation paths composed in 0.025s.
qiskit.transpiler.passes.basis.basis_translator - ForkProcess-4 - DEBUG: Updated transform for mapped instr (&#39;h&#39;, 1) h, [] to
        ┌──────────┐
q305_0: ┤ U2(0,pi) ├
        └──────────┘
qiskit.transpiler.passes.basis.basis_translator - ForkProcess-3 - INFO: Basis translation instructions replaced in 0.000s.
qiskit.transpiler.passes.basis.basis_translator - ForkProcess-4 - INFO: Basis translation paths composed in 0.024s.
qiskit.transpiler.runningpassmanager - ForkProcess-3 - INFO: Pass: BasisTranslator - 64.18514 (ms)
qiskit.transpiler.passes.basis.basis_translator - ForkProcess-4 - INFO: Basis translation instructions replaced in 0.000s.
qiskit.transpiler.runningpassmanager - ForkProcess-3 - INFO: Pass: CheckCXDirection - 0.13709 (ms)
qiskit.transpiler.runningpassmanager - ForkProcess-4 - INFO: Pass: BasisTranslator - 62.48379 (ms)
qiskit.transpiler.runningpassmanager - ForkProcess-4 - INFO: Pass: CheckCXDirection - 0.15211 (ms)
qiskit.transpiler.runningpassmanager - ForkProcess-3 - INFO: Pass: CXDirection - 1.07312 (ms)
qiskit.transpiler.runningpassmanager - ForkProcess-3 - INFO: Pass: RemoveResetInZeroState - 0.05794 (ms)
qiskit.transpiler.runningpassmanager - ForkProcess-4 - INFO: Pass: CXDirection - 1.12700 (ms)
qiskit.transpiler.runningpassmanager - ForkProcess-3 - INFO: Pass: Depth - 0.08702 (ms)
qiskit.transpiler.runningpassmanager - ForkProcess-4 - INFO: Pass: RemoveResetInZeroState - 0.04292 (ms)
qiskit.transpiler.runningpassmanager - ForkProcess-4 - INFO: Pass: Depth - 0.13113 (ms)
qiskit.transpiler.runningpassmanager - ForkProcess-3 - INFO: Pass: FixedPoint - 0.07391 (ms)
qiskit.transpiler.runningpassmanager - ForkProcess-4 - INFO: Pass: FixedPoint - 0.05603 (ms)
qiskit.transpiler.runningpassmanager - ForkProcess-3 - INFO: Pass: Optimize1qGates - 2.36106 (ms)
qiskit.transpiler.runningpassmanager - ForkProcess-4 - INFO: Pass: Optimize1qGates - 2.56300 (ms)
qiskit.transpiler.runningpassmanager - ForkProcess-3 - INFO: Pass: CXCancellation - 0.14305 (ms)
qiskit.transpiler.runningpassmanager - ForkProcess-4 - INFO: Pass: CXCancellation - 0.12708 (ms)
qiskit.transpiler.runningpassmanager - ForkProcess-3 - INFO: Pass: Depth - 0.03695 (ms)
qiskit.transpiler.runningpassmanager - ForkProcess-3 - INFO: Pass: FixedPoint - 0.02909 (ms)
qiskit.transpiler.runningpassmanager - ForkProcess-4 - INFO: Pass: Depth - 0.05078 (ms)
qiskit.transpiler.runningpassmanager - ForkProcess-3 - INFO: Pass: Optimize1qGates - 0.60916 (ms)
qiskit.transpiler.runningpassmanager - ForkProcess-3 - INFO: Pass: CXCancellation - 0.14591 (ms)
qiskit.transpiler.runningpassmanager - ForkProcess-3 - INFO: Pass: Depth - 0.04983 (ms)
qiskit.transpiler.runningpassmanager - ForkProcess-3 - INFO: Pass: FixedPoint - 0.03099 (ms)
qiskit.transpiler.runningpassmanager - ForkProcess-3 - INFO: Pass: Optimize1qGates - 0.29421 (ms)
qiskit.transpiler.runningpassmanager - ForkProcess-4 - INFO: Pass: FixedPoint - 0.02980 (ms)
qiskit.transpiler.runningpassmanager - ForkProcess-3 - INFO: Pass: CXCancellation - 0.19026 (ms)
qiskit.transpiler.runningpassmanager - ForkProcess-4 - INFO: Pass: Optimize1qGates - 0.35596 (ms)
qiskit.transpiler.runningpassmanager - ForkProcess-4 - INFO: Pass: CXCancellation - 0.10610 (ms)
qiskit.transpiler.runningpassmanager - ForkProcess-4 - INFO: Pass: Depth - 0.04578 (ms)
qiskit.transpiler.runningpassmanager - ForkProcess-4 - INFO: Pass: FixedPoint - 0.03409 (ms)
qiskit.transpiler.runningpassmanager - ForkProcess-4 - INFO: Pass: Optimize1qGates - 0.46515 (ms)
qiskit.transpiler.runningpassmanager - ForkProcess-4 - INFO: Pass: CXCancellation - 0.12493 (ms)
qiskit.compiler.transpile - MainProcess - INFO: Total Transpile Time - 295.99905 (ms)
</pre></div></div>
</div>
<p>ログメッセージのフォーマットが変更され、各トランスパイラープロセスのプロセス名が含まれるようになり、どのログメッセージが進行しているかが明確になりました。</p>
<p>設定には多くの異なるオプションがあります。この例ではかなり限られています。より多くの例とオプションについてはドキュメントを参照し、あなたの特別なユースケースと好みに応じてより洗練されたユースケースをビルド出来るようにしてください。</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[35]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="kn">import</span> <span class="nn">qiskit.tools.jupyter</span>
<span class="o">%</span><span class="k">qiskit_version_table</span>
<span class="o">%</span><span class="k">qiskit_copyright</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area rendered_html docutils container">
<h3>Version Information</h3><table><tr><th>Qiskit Software</th><th>Version</th></tr><tr><td>Qiskit</td><td>None</td></tr><tr><td>Terra</td><td>0.16.0.dev0+6a1efd6</td></tr><tr><td>Aer</td><td>0.6.0</td></tr><tr><td>Ignis</td><td>0.4.0.dev0+f885a59</td></tr><tr><td>Aqua</td><td>0.8.0.dev0+d0bce47</td></tr><tr><td>IBM Q Provider</td><td>0.8.0</td></tr><tr><th>System information</th></tr><tr><td>Python</td><td>3.7.5 (default, Nov  1 2019, 02:16:32)
[Clang 11.0.0 (clang-1100.0.33.8)]</td></tr><tr><td>OS</td><td>Darwin</td></tr><tr><td>CPUs</td><td>2</td></tr><tr><td>Memory (Gb)</td><td>16.0</td></tr><tr><td colspan='2'>Thu Aug 13 14:36:19 2020 CEST</td></tr></table></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area rendered_html docutils container">
<div style='width: 100%; background-color:#d5d9e0;padding-left: 10px; padding-bottom: 10px; padding-right: 10px; padding-top: 5px'><h3>This code is a part of Qiskit</h3><p>&copy; Copyright IBM 2017, 2020.</p><p>This code is licensed under the Apache License, Version 2.0. You may<br>obtain a copy of this license in the LICENSE.txt file in the root directory<br> of this source tree or at http://www.apache.org/licenses/LICENSE-2.0.<p>Any modifications or derivative works of this code must retain this<br>copyright notice, and modified files need to carry a notice indicating<br>that they have been altered from the originals.</p></div></div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span>
</pre></div>
</div>
</div>
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="../pulse/index.html" class="btn btn-neutral float-right" title="Pulse Tutorials" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="3_advanced_circuit_visualization.html" class="btn btn-neutral float-left" title="量子回路の可視化" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        
        &copy; 著作権 2020, Qiskit Development Team
      <span class="lastupdated">
        最終更新: 2020/09/09
      </span>

    </p>
  </div>
    
    
    
    Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  <div class="rst-versions" data-toggle="rst-versions" role="note" aria-label="versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    <span class="fa fa-book"> 表示</span>
    lang: Japanese
    <span class="fa fa-caret-down"></span>
  </span>
  <div class="rst-other-versions">
    
    <dl>
      <dt>言語</dt>
      
        <dd><a class="version" href="/documentation/tutorials/circuits_advanced/4_transpiler_passes_and_passmanager.html">English</a></dd>
      
        <dd><a class="version" href="/documentation/locale/ja_JP/tutorials/circuits_advanced/4_transpiler_passes_and_passmanager.html">Japanese</a></dd>
      
        <dd><a class="version" href="/documentation/locale/de_DE/tutorials/circuits_advanced/4_transpiler_passes_and_passmanager.html">German</a></dd>
      
        <dd><a class="version" href="/documentation/locale/ko_KR/tutorials/circuits_advanced/4_transpiler_passes_and_passmanager.html">Korean</a></dd>
      
    </dl>
    
  </div>
  <script>
    jQuery('.version').click((evt) => {
      const hash = window.location.hash
      const complete_url = evt.target.href + hash
      window.location = complete_url
      evt.preventDefault()
    })
  </script>
</div>

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
  
 <script type="text/javascript">
    $(document).ready(function() {
        $(".toggle > *").hide();
        $(".toggle .header").show();
        $(".toggle .header").click(function() {
            $(this).parent().children().not(".header").toggle(400);
            $(this).parent().children(".header").toggleClass("open");
        })
    });
</script>


</body>
</html>